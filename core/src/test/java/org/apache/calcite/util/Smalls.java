begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * Licensed to the Apache Software Foundation (ASF) under one or more  * contributor license agreements.  See the NOTICE file distributed with  * this work for additional information regarding copyright ownership.  * The ASF licenses this file to you under the Apache License, Version 2.0  * (the "License"); you may not use this file except in compliance with  * the License.  You may obtain a copy of the License at  *  * http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|util
package|;
end_package

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|DataContext
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|adapter
operator|.
name|java
operator|.
name|AbstractQueryableTable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|linq4j
operator|.
name|BaseQueryable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|linq4j
operator|.
name|Enumerable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|linq4j
operator|.
name|Enumerator
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|linq4j
operator|.
name|Linq4j
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|linq4j
operator|.
name|QueryProvider
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|linq4j
operator|.
name|Queryable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|linq4j
operator|.
name|function
operator|.
name|Function1
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|linq4j
operator|.
name|function
operator|.
name|Function2
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|linq4j
operator|.
name|function
operator|.
name|Parameter
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|linq4j
operator|.
name|tree
operator|.
name|Types
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|type
operator|.
name|RelDataType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|type
operator|.
name|RelDataTypeFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|type
operator|.
name|RelProtoDataType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rex
operator|.
name|RexLiteral
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|schema
operator|.
name|QueryableTable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|schema
operator|.
name|ScannableTable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|schema
operator|.
name|SchemaPlus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|schema
operator|.
name|TranslatableTable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|schema
operator|.
name|impl
operator|.
name|AbstractTable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|schema
operator|.
name|impl
operator|.
name|ViewTable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|sql
operator|.
name|SqlDialect
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|sql
operator|.
name|type
operator|.
name|SqlTypeName
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|ImmutableList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Method
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|AbstractList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|hamcrest
operator|.
name|CoreMatchers
operator|.
name|is
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|Assert
operator|.
name|assertThat
import|;
end_import

begin_comment
comment|/**  * Holder for various classes and functions used in tests as user-defined  * functions and so forth.  */
end_comment

begin_class
specifier|public
class|class
name|Smalls
block|{
specifier|public
specifier|static
specifier|final
name|Method
name|GENERATE_STRINGS_METHOD
init|=
name|Types
operator|.
name|lookupMethod
argument_list|(
name|Smalls
operator|.
name|class
argument_list|,
literal|"generateStrings"
argument_list|,
name|Integer
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|Method
name|MAZE_METHOD
init|=
name|Types
operator|.
name|lookupMethod
argument_list|(
name|MazeTable
operator|.
name|class
argument_list|,
literal|"generate"
argument_list|,
name|int
operator|.
name|class
argument_list|,
name|int
operator|.
name|class
argument_list|,
name|int
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|Method
name|MAZE2_METHOD
init|=
name|Types
operator|.
name|lookupMethod
argument_list|(
name|MazeTable
operator|.
name|class
argument_list|,
literal|"generate2"
argument_list|,
name|int
operator|.
name|class
argument_list|,
name|int
operator|.
name|class
argument_list|,
name|Integer
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|Method
name|MAZE3_METHOD
init|=
name|Types
operator|.
name|lookupMethod
argument_list|(
name|MazeTable
operator|.
name|class
argument_list|,
literal|"generate3"
argument_list|,
name|String
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|Method
name|MULTIPLICATION_TABLE_METHOD
init|=
name|Types
operator|.
name|lookupMethod
argument_list|(
name|Smalls
operator|.
name|class
argument_list|,
literal|"multiplicationTable"
argument_list|,
name|int
operator|.
name|class
argument_list|,
name|int
operator|.
name|class
argument_list|,
name|Integer
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|Method
name|VIEW_METHOD
init|=
name|Types
operator|.
name|lookupMethod
argument_list|(
name|Smalls
operator|.
name|class
argument_list|,
literal|"view"
argument_list|,
name|String
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|Method
name|STR_METHOD
init|=
name|Types
operator|.
name|lookupMethod
argument_list|(
name|Smalls
operator|.
name|class
argument_list|,
literal|"str"
argument_list|,
name|Object
operator|.
name|class
argument_list|,
name|Object
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|Method
name|STRING_UNION_METHOD
init|=
name|Types
operator|.
name|lookupMethod
argument_list|(
name|Smalls
operator|.
name|class
argument_list|,
literal|"stringUnion"
argument_list|,
name|Queryable
operator|.
name|class
argument_list|,
name|Queryable
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|Method
name|PROCESS_CURSOR_METHOD
init|=
name|Types
operator|.
name|lookupMethod
argument_list|(
name|Smalls
operator|.
name|class
argument_list|,
literal|"processCursor"
argument_list|,
name|int
operator|.
name|class
argument_list|,
name|Enumerable
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|Method
name|PROCESS_CURSORS_METHOD
init|=
name|Types
operator|.
name|lookupMethod
argument_list|(
name|Smalls
operator|.
name|class
argument_list|,
literal|"processCursors"
argument_list|,
name|int
operator|.
name|class
argument_list|,
name|Enumerable
operator|.
name|class
argument_list|,
name|Enumerable
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|private
name|Smalls
parameter_list|()
block|{
block|}
specifier|private
specifier|static
name|QueryableTable
name|oneThreePlus
parameter_list|(
name|String
name|s
parameter_list|)
block|{
name|List
argument_list|<
name|Integer
argument_list|>
name|items
decl_stmt|;
comment|// Argument is null in case SQL contains function call with expression.
comment|// Then the engine calls a function with null arguments to get getRowType.
if|if
condition|(
name|s
operator|==
literal|null
condition|)
block|{
name|items
operator|=
name|ImmutableList
operator|.
name|of
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|Integer
name|latest
init|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|s
operator|.
name|substring
argument_list|(
literal|1
argument_list|,
name|s
operator|.
name|length
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|)
decl_stmt|;
name|items
operator|=
name|ImmutableList
operator|.
name|of
argument_list|(
literal|1
argument_list|,
literal|3
argument_list|,
name|latest
argument_list|)
expr_stmt|;
block|}
specifier|final
name|Enumerable
argument_list|<
name|Integer
argument_list|>
name|enumerable
init|=
name|Linq4j
operator|.
name|asEnumerable
argument_list|(
name|items
argument_list|)
decl_stmt|;
return|return
operator|new
name|AbstractQueryableTable
argument_list|(
name|Integer
operator|.
name|class
argument_list|)
block|{
specifier|public
parameter_list|<
name|E
parameter_list|>
name|Queryable
argument_list|<
name|E
argument_list|>
name|asQueryable
parameter_list|(
name|QueryProvider
name|queryProvider
parameter_list|,
name|SchemaPlus
name|schema
parameter_list|,
name|String
name|tableName
parameter_list|)
block|{
comment|//noinspection unchecked
return|return
operator|(
name|Queryable
argument_list|<
name|E
argument_list|>
operator|)
name|enumerable
operator|.
name|asQueryable
argument_list|()
return|;
block|}
specifier|public
name|RelDataType
name|getRowType
parameter_list|(
name|RelDataTypeFactory
name|typeFactory
parameter_list|)
block|{
return|return
name|typeFactory
operator|.
name|builder
argument_list|()
operator|.
name|add
argument_list|(
literal|"c"
argument_list|,
name|SqlTypeName
operator|.
name|INTEGER
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
block|}
return|;
block|}
specifier|public
specifier|static
parameter_list|<
name|T
parameter_list|>
name|Queryable
argument_list|<
name|T
argument_list|>
name|stringUnion
parameter_list|(
name|Queryable
argument_list|<
name|T
argument_list|>
name|q0
parameter_list|,
name|Queryable
argument_list|<
name|T
argument_list|>
name|q1
parameter_list|)
block|{
return|return
name|q0
operator|.
name|concat
argument_list|(
name|q1
argument_list|)
return|;
block|}
comment|/** A function that generates a table that generates a sequence of    * {@link IntString} values. */
specifier|public
specifier|static
name|QueryableTable
name|generateStrings
parameter_list|(
specifier|final
name|Integer
name|count
parameter_list|)
block|{
return|return
operator|new
name|AbstractQueryableTable
argument_list|(
name|IntString
operator|.
name|class
argument_list|)
block|{
specifier|public
name|RelDataType
name|getRowType
parameter_list|(
name|RelDataTypeFactory
name|typeFactory
parameter_list|)
block|{
return|return
name|typeFactory
operator|.
name|createJavaType
argument_list|(
name|IntString
operator|.
name|class
argument_list|)
return|;
block|}
specifier|public
parameter_list|<
name|T
parameter_list|>
name|Queryable
argument_list|<
name|T
argument_list|>
name|asQueryable
parameter_list|(
name|QueryProvider
name|queryProvider
parameter_list|,
name|SchemaPlus
name|schema
parameter_list|,
name|String
name|tableName
parameter_list|)
block|{
name|BaseQueryable
argument_list|<
name|IntString
argument_list|>
name|queryable
init|=
operator|new
name|BaseQueryable
argument_list|<
name|IntString
argument_list|>
argument_list|(
literal|null
argument_list|,
name|IntString
operator|.
name|class
argument_list|,
literal|null
argument_list|)
block|{
specifier|public
name|Enumerator
argument_list|<
name|IntString
argument_list|>
name|enumerator
parameter_list|()
block|{
return|return
operator|new
name|Enumerator
argument_list|<
name|IntString
argument_list|>
argument_list|()
block|{
specifier|static
specifier|final
name|String
name|Z
init|=
literal|"abcdefghijklm"
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|int
name|curI
decl_stmt|;
name|String
name|curS
decl_stmt|;
specifier|public
name|IntString
name|current
parameter_list|()
block|{
return|return
operator|new
name|IntString
argument_list|(
name|curI
argument_list|,
name|curS
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|moveNext
parameter_list|()
block|{
if|if
condition|(
name|i
operator|<
name|count
condition|)
block|{
name|curI
operator|=
name|i
expr_stmt|;
name|curS
operator|=
name|Z
operator|.
name|substring
argument_list|(
literal|0
argument_list|,
name|i
operator|%
name|Z
operator|.
name|length
argument_list|()
argument_list|)
expr_stmt|;
operator|++
name|i
expr_stmt|;
return|return
literal|true
return|;
block|}
else|else
block|{
return|return
literal|false
return|;
block|}
block|}
specifier|public
name|void
name|reset
parameter_list|()
block|{
name|i
operator|=
literal|0
expr_stmt|;
block|}
specifier|public
name|void
name|close
parameter_list|()
block|{
block|}
block|}
return|;
block|}
block|}
decl_stmt|;
comment|//noinspection unchecked
return|return
operator|(
name|Queryable
argument_list|<
name|T
argument_list|>
operator|)
name|queryable
return|;
block|}
block|}
return|;
block|}
comment|/** A function that generates multiplication table of {@code ncol} columns x    * {@code nrow} rows. */
specifier|public
specifier|static
name|QueryableTable
name|multiplicationTable
parameter_list|(
specifier|final
name|int
name|ncol
parameter_list|,
specifier|final
name|int
name|nrow
parameter_list|,
name|Integer
name|offset
parameter_list|)
block|{
specifier|final
name|int
name|offs
init|=
name|offset
operator|==
literal|null
condition|?
literal|0
else|:
name|offset
decl_stmt|;
return|return
operator|new
name|AbstractQueryableTable
argument_list|(
name|Object
index|[]
operator|.
expr|class
argument_list|)
block|{
specifier|public
name|RelDataType
name|getRowType
parameter_list|(
name|RelDataTypeFactory
name|typeFactory
parameter_list|)
block|{
specifier|final
name|RelDataTypeFactory
operator|.
name|FieldInfoBuilder
name|builder
init|=
name|typeFactory
operator|.
name|builder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|add
argument_list|(
literal|"row_name"
argument_list|,
name|typeFactory
operator|.
name|createJavaType
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
specifier|final
name|RelDataType
name|int_
init|=
name|typeFactory
operator|.
name|createJavaType
argument_list|(
name|int
operator|.
name|class
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|1
init|;
name|i
operator|<=
name|ncol
condition|;
name|i
operator|++
control|)
block|{
name|builder
operator|.
name|add
argument_list|(
literal|"c"
operator|+
name|i
argument_list|,
name|int_
argument_list|)
expr_stmt|;
block|}
return|return
name|builder
operator|.
name|build
argument_list|()
return|;
block|}
specifier|public
name|Queryable
argument_list|<
name|Object
index|[]
argument_list|>
name|asQueryable
parameter_list|(
name|QueryProvider
name|queryProvider
parameter_list|,
name|SchemaPlus
name|schema
parameter_list|,
name|String
name|tableName
parameter_list|)
block|{
specifier|final
name|List
argument_list|<
name|Object
index|[]
argument_list|>
name|table
init|=
operator|new
name|AbstractList
argument_list|<
name|Object
index|[]
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|Object
index|[]
name|get
parameter_list|(
name|int
name|index
parameter_list|)
block|{
name|Object
index|[]
name|cur
init|=
operator|new
name|Object
index|[
name|ncol
operator|+
literal|1
index|]
decl_stmt|;
name|cur
index|[
literal|0
index|]
operator|=
literal|"row "
operator|+
name|index
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|1
init|;
name|j
operator|<=
name|ncol
condition|;
name|j
operator|++
control|)
block|{
name|cur
index|[
name|j
index|]
operator|=
name|j
operator|*
operator|(
name|index
operator|+
literal|1
operator|)
operator|+
name|offs
expr_stmt|;
block|}
return|return
name|cur
return|;
block|}
annotation|@
name|Override
specifier|public
name|int
name|size
parameter_list|()
block|{
return|return
name|nrow
return|;
block|}
block|}
decl_stmt|;
return|return
name|Linq4j
operator|.
name|asEnumerable
argument_list|(
name|table
argument_list|)
operator|.
name|asQueryable
argument_list|()
return|;
block|}
block|}
return|;
block|}
comment|/**    * A function that adds a number to the first column of input cursor    */
specifier|public
specifier|static
name|QueryableTable
name|processCursor
parameter_list|(
specifier|final
name|int
name|offset
parameter_list|,
specifier|final
name|Enumerable
argument_list|<
name|Object
index|[]
argument_list|>
name|a
parameter_list|)
block|{
return|return
operator|new
name|AbstractQueryableTable
argument_list|(
name|Object
index|[]
operator|.
expr|class
argument_list|)
block|{
specifier|public
name|RelDataType
name|getRowType
parameter_list|(
name|RelDataTypeFactory
name|typeFactory
parameter_list|)
block|{
return|return
name|typeFactory
operator|.
name|builder
argument_list|()
operator|.
name|add
argument_list|(
literal|"result"
argument_list|,
name|SqlTypeName
operator|.
name|INTEGER
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
specifier|public
parameter_list|<
name|T
parameter_list|>
name|Queryable
argument_list|<
name|T
argument_list|>
name|asQueryable
parameter_list|(
name|QueryProvider
name|queryProvider
parameter_list|,
name|SchemaPlus
name|schema
parameter_list|,
name|String
name|tableName
parameter_list|)
block|{
specifier|final
name|Enumerable
argument_list|<
name|Integer
argument_list|>
name|enumerable
init|=
name|a
operator|.
name|select
argument_list|(
operator|new
name|Function1
argument_list|<
name|Object
index|[]
argument_list|,
name|Integer
argument_list|>
argument_list|()
block|{
specifier|public
name|Integer
name|apply
parameter_list|(
name|Object
index|[]
name|a0
parameter_list|)
block|{
return|return
name|offset
operator|+
operator|(
operator|(
name|Integer
operator|)
name|a0
index|[
literal|0
index|]
operator|)
return|;
block|}
block|}
argument_list|)
decl_stmt|;
comment|//noinspection unchecked
return|return
operator|(
name|Queryable
operator|)
name|enumerable
operator|.
name|asQueryable
argument_list|()
return|;
block|}
block|}
return|;
block|}
comment|/**    * A function that sums the second column of first input cursor, second    * column of first input and the given int.    */
specifier|public
specifier|static
name|QueryableTable
name|processCursors
parameter_list|(
specifier|final
name|int
name|offset
parameter_list|,
specifier|final
name|Enumerable
argument_list|<
name|Object
index|[]
argument_list|>
name|a
parameter_list|,
specifier|final
name|Enumerable
argument_list|<
name|IntString
argument_list|>
name|b
parameter_list|)
block|{
return|return
operator|new
name|AbstractQueryableTable
argument_list|(
name|Object
index|[]
operator|.
expr|class
argument_list|)
block|{
specifier|public
name|RelDataType
name|getRowType
parameter_list|(
name|RelDataTypeFactory
name|typeFactory
parameter_list|)
block|{
return|return
name|typeFactory
operator|.
name|builder
argument_list|()
operator|.
name|add
argument_list|(
literal|"result"
argument_list|,
name|SqlTypeName
operator|.
name|INTEGER
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
specifier|public
parameter_list|<
name|T
parameter_list|>
name|Queryable
argument_list|<
name|T
argument_list|>
name|asQueryable
parameter_list|(
name|QueryProvider
name|queryProvider
parameter_list|,
name|SchemaPlus
name|schema
parameter_list|,
name|String
name|tableName
parameter_list|)
block|{
specifier|final
name|Enumerable
argument_list|<
name|Integer
argument_list|>
name|enumerable
init|=
name|a
operator|.
name|zip
argument_list|(
name|b
argument_list|,
operator|new
name|Function2
argument_list|<
name|Object
index|[]
argument_list|,
name|IntString
argument_list|,
name|Integer
argument_list|>
argument_list|()
block|{
specifier|public
name|Integer
name|apply
parameter_list|(
name|Object
index|[]
name|v0
parameter_list|,
name|IntString
name|v1
parameter_list|)
block|{
return|return
operator|(
operator|(
name|Integer
operator|)
name|v0
index|[
literal|1
index|]
operator|)
operator|+
name|v1
operator|.
name|n
operator|+
name|offset
return|;
block|}
block|}
argument_list|)
decl_stmt|;
comment|//noinspection unchecked
return|return
operator|(
name|Queryable
operator|)
name|enumerable
operator|.
name|asQueryable
argument_list|()
return|;
block|}
block|}
return|;
block|}
specifier|public
specifier|static
name|TranslatableTable
name|view
parameter_list|(
name|String
name|s
parameter_list|)
block|{
return|return
operator|new
name|ViewTable
argument_list|(
name|Object
operator|.
name|class
argument_list|,
operator|new
name|RelProtoDataType
argument_list|()
block|{
specifier|public
name|RelDataType
name|apply
parameter_list|(
name|RelDataTypeFactory
name|typeFactory
parameter_list|)
block|{
return|return
name|typeFactory
operator|.
name|builder
argument_list|()
operator|.
name|add
argument_list|(
literal|"c"
argument_list|,
name|SqlTypeName
operator|.
name|INTEGER
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
block|}
argument_list|,
literal|"values (1), (3), "
operator|+
name|s
argument_list|,
name|ImmutableList
operator|.
expr|<
name|String
operator|>
name|of
argument_list|()
argument_list|)
return|;
block|}
specifier|public
specifier|static
name|TranslatableTable
name|str
parameter_list|(
name|Object
name|o
parameter_list|,
name|Object
name|p
parameter_list|)
block|{
name|assertThat
argument_list|(
name|RexLiteral
operator|.
name|validConstant
argument_list|(
name|o
argument_list|,
name|Litmus
operator|.
name|THROW
argument_list|)
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|RexLiteral
operator|.
name|validConstant
argument_list|(
name|p
argument_list|,
name|Litmus
operator|.
name|THROW
argument_list|)
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|new
name|ViewTable
argument_list|(
name|Object
operator|.
name|class
argument_list|,
operator|new
name|RelProtoDataType
argument_list|()
block|{
specifier|public
name|RelDataType
name|apply
parameter_list|(
name|RelDataTypeFactory
name|typeFactory
parameter_list|)
block|{
return|return
name|typeFactory
operator|.
name|builder
argument_list|()
operator|.
name|add
argument_list|(
literal|"c"
argument_list|,
name|SqlTypeName
operator|.
name|VARCHAR
argument_list|,
literal|100
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
block|}
argument_list|,
literal|"values "
operator|+
name|SqlDialect
operator|.
name|CALCITE
operator|.
name|quoteStringLiteral
argument_list|(
name|o
operator|.
name|toString
argument_list|()
argument_list|)
operator|+
literal|", "
operator|+
name|SqlDialect
operator|.
name|CALCITE
operator|.
name|quoteStringLiteral
argument_list|(
name|p
operator|.
name|toString
argument_list|()
argument_list|)
argument_list|,
name|ImmutableList
operator|.
expr|<
name|String
operator|>
name|of
argument_list|()
argument_list|)
return|;
block|}
comment|/** Class with int and String fields. */
specifier|public
specifier|static
class|class
name|IntString
block|{
specifier|public
specifier|final
name|int
name|n
decl_stmt|;
specifier|public
specifier|final
name|String
name|s
decl_stmt|;
specifier|public
name|IntString
parameter_list|(
name|int
name|n
parameter_list|,
name|String
name|s
parameter_list|)
block|{
name|this
operator|.
name|n
operator|=
name|n
expr_stmt|;
name|this
operator|.
name|s
operator|=
name|s
expr_stmt|;
block|}
specifier|public
name|String
name|toString
parameter_list|()
block|{
return|return
literal|"{n="
operator|+
name|n
operator|+
literal|", s="
operator|+
name|s
operator|+
literal|"}"
return|;
block|}
block|}
comment|/** Example of a UDF with a non-static {@code eval} method,    * and named parameters. */
specifier|public
specifier|static
class|class
name|MyPlusFunction
block|{
specifier|public
name|int
name|eval
parameter_list|(
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"x"
argument_list|)
name|int
name|x
parameter_list|,
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"y"
argument_list|)
name|int
name|y
parameter_list|)
block|{
return|return
name|x
operator|+
name|y
return|;
block|}
block|}
comment|/** Example of a UDF with named parameters. */
specifier|public
specifier|static
class|class
name|MyLeftFunction
block|{
specifier|public
name|String
name|eval
parameter_list|(
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"s"
argument_list|)
name|String
name|s
parameter_list|,
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"n"
argument_list|)
name|int
name|n
parameter_list|)
block|{
return|return
name|s
operator|.
name|substring
argument_list|(
literal|0
argument_list|,
name|n
argument_list|)
return|;
block|}
block|}
comment|/** Example of a UDF with named parameters, some of them optional. */
specifier|public
specifier|static
class|class
name|MyAbcdeFunction
block|{
specifier|public
name|String
name|eval
parameter_list|(
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"A"
argument_list|,
name|optional
operator|=
literal|false
argument_list|)
name|Integer
name|a
parameter_list|,
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"B"
argument_list|,
name|optional
operator|=
literal|true
argument_list|)
name|Integer
name|b
parameter_list|,
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"C"
argument_list|,
name|optional
operator|=
literal|false
argument_list|)
name|Integer
name|c
parameter_list|,
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"D"
argument_list|,
name|optional
operator|=
literal|true
argument_list|)
name|Integer
name|d
parameter_list|,
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"E"
argument_list|,
name|optional
operator|=
literal|true
argument_list|)
name|Integer
name|e
parameter_list|)
block|{
return|return
literal|"{a: "
operator|+
name|a
operator|+
literal|", b: "
operator|+
name|b
operator|+
literal|", c: "
operator|+
name|c
operator|+
literal|", d: "
operator|+
name|d
operator|+
literal|", e: "
operator|+
name|e
operator|+
literal|"}"
return|;
block|}
block|}
comment|/** Example of a non-strict UDF. (Does something useful when passed NULL.) */
specifier|public
specifier|static
class|class
name|MyToStringFunction
block|{
specifier|public
specifier|static
name|String
name|eval
parameter_list|(
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"o"
argument_list|)
name|Object
name|o
parameter_list|)
block|{
if|if
condition|(
name|o
operator|==
literal|null
condition|)
block|{
return|return
literal|"<null>"
return|;
block|}
return|return
literal|"<"
operator|+
name|o
operator|.
name|toString
argument_list|()
operator|+
literal|">"
return|;
block|}
block|}
comment|/** Example of a UDF with a static {@code eval} method. Class is abstract,    * but code-generator should not need to instantiate it. */
specifier|public
specifier|abstract
specifier|static
class|class
name|MyDoubleFunction
block|{
specifier|private
name|MyDoubleFunction
parameter_list|()
block|{
block|}
specifier|public
specifier|static
name|int
name|eval
parameter_list|(
name|int
name|x
parameter_list|)
block|{
return|return
name|x
operator|*
literal|2
return|;
block|}
block|}
comment|/** User-defined function with two arguments. */
specifier|public
specifier|static
class|class
name|MyIncrement
block|{
specifier|public
name|float
name|eval
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
block|{
return|return
name|x
operator|+
name|x
operator|*
name|y
operator|/
literal|100
return|;
block|}
block|}
comment|/** Example of a UDF that has overloaded UDFs (same name, different args). */
specifier|public
specifier|abstract
specifier|static
class|class
name|CountArgs0Function
block|{
specifier|private
name|CountArgs0Function
parameter_list|()
block|{
block|}
specifier|public
specifier|static
name|int
name|eval
parameter_list|()
block|{
return|return
literal|0
return|;
block|}
block|}
comment|/** See {@link CountArgs0Function}. */
specifier|public
specifier|abstract
specifier|static
class|class
name|CountArgs1Function
block|{
specifier|private
name|CountArgs1Function
parameter_list|()
block|{
block|}
specifier|public
specifier|static
name|int
name|eval
parameter_list|(
name|int
name|x
parameter_list|)
block|{
return|return
literal|1
return|;
block|}
block|}
comment|/** See {@link CountArgs0Function}. */
specifier|public
specifier|abstract
specifier|static
class|class
name|CountArgs2Function
block|{
specifier|private
name|CountArgs2Function
parameter_list|()
block|{
block|}
specifier|public
specifier|static
name|int
name|eval
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
block|{
return|return
literal|2
return|;
block|}
block|}
comment|/** Example of a UDF class that needs to be instantiated but cannot be. */
specifier|public
specifier|abstract
specifier|static
class|class
name|AwkwardFunction
block|{
specifier|private
name|AwkwardFunction
parameter_list|()
block|{
block|}
specifier|public
name|int
name|eval
parameter_list|(
name|int
name|x
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
block|}
comment|/** UDF class that has multiple methods, some overloaded. */
specifier|public
specifier|static
class|class
name|MultipleFunction
block|{
specifier|private
name|MultipleFunction
parameter_list|()
block|{
block|}
comment|// Three overloads
specifier|public
specifier|static
name|String
name|fun1
parameter_list|(
name|String
name|x
parameter_list|)
block|{
return|return
name|x
operator|.
name|toLowerCase
argument_list|()
return|;
block|}
specifier|public
specifier|static
name|int
name|fun1
parameter_list|(
name|int
name|x
parameter_list|)
block|{
return|return
name|x
operator|*
literal|2
return|;
block|}
specifier|public
specifier|static
name|int
name|fun1
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
block|{
return|return
name|x
operator|+
name|y
return|;
block|}
comment|// Another method
specifier|public
specifier|static
name|int
name|fun2
parameter_list|(
name|int
name|x
parameter_list|)
block|{
return|return
name|x
operator|*
literal|3
return|;
block|}
comment|// Non-static method cannot be used because constructor is private
specifier|public
name|int
name|nonStatic
parameter_list|(
name|int
name|x
parameter_list|)
block|{
return|return
name|x
operator|*
literal|3
return|;
block|}
block|}
comment|/** UDF class that provides user-defined functions for each data type. */
specifier|public
specifier|static
class|class
name|AllTypesFunction
block|{
specifier|private
name|AllTypesFunction
parameter_list|()
block|{
block|}
specifier|public
specifier|static
name|long
name|dateFun
parameter_list|(
name|java
operator|.
name|sql
operator|.
name|Date
name|x
parameter_list|)
block|{
return|return
name|x
operator|==
literal|null
condition|?
operator|-
literal|1L
else|:
name|x
operator|.
name|getTime
argument_list|()
return|;
block|}
specifier|public
specifier|static
name|long
name|timestampFun
parameter_list|(
name|java
operator|.
name|sql
operator|.
name|Timestamp
name|x
parameter_list|)
block|{
return|return
name|x
operator|==
literal|null
condition|?
operator|-
literal|1L
else|:
name|x
operator|.
name|getTime
argument_list|()
return|;
block|}
specifier|public
specifier|static
name|long
name|timeFun
parameter_list|(
name|java
operator|.
name|sql
operator|.
name|Time
name|x
parameter_list|)
block|{
return|return
name|x
operator|==
literal|null
condition|?
operator|-
literal|1L
else|:
name|x
operator|.
name|getTime
argument_list|()
return|;
block|}
block|}
comment|/** Example of a user-defined aggregate function (UDAF). */
specifier|public
specifier|static
class|class
name|MySumFunction
block|{
specifier|public
name|MySumFunction
parameter_list|()
block|{
block|}
specifier|public
name|long
name|init
parameter_list|()
block|{
return|return
literal|0L
return|;
block|}
specifier|public
name|long
name|add
parameter_list|(
name|long
name|accumulator
parameter_list|,
name|int
name|v
parameter_list|)
block|{
return|return
name|accumulator
operator|+
name|v
return|;
block|}
specifier|public
name|long
name|merge
parameter_list|(
name|long
name|accumulator0
parameter_list|,
name|long
name|accumulator1
parameter_list|)
block|{
return|return
name|accumulator0
operator|+
name|accumulator1
return|;
block|}
specifier|public
name|long
name|result
parameter_list|(
name|long
name|accumulator
parameter_list|)
block|{
return|return
name|accumulator
return|;
block|}
block|}
comment|/** Example of a user-defined aggregate function (UDAF), whose methods are    * static. */
specifier|public
specifier|static
class|class
name|MyStaticSumFunction
block|{
specifier|public
specifier|static
name|long
name|init
parameter_list|()
block|{
return|return
literal|0L
return|;
block|}
specifier|public
specifier|static
name|long
name|add
parameter_list|(
name|long
name|accumulator
parameter_list|,
name|int
name|v
parameter_list|)
block|{
return|return
name|accumulator
operator|+
name|v
return|;
block|}
specifier|public
specifier|static
name|long
name|merge
parameter_list|(
name|long
name|accumulator0
parameter_list|,
name|long
name|accumulator1
parameter_list|)
block|{
return|return
name|accumulator0
operator|+
name|accumulator1
return|;
block|}
specifier|public
specifier|static
name|long
name|result
parameter_list|(
name|long
name|accumulator
parameter_list|)
block|{
return|return
name|accumulator
return|;
block|}
block|}
comment|/** User-defined function. */
specifier|public
specifier|static
class|class
name|SumFunctionBadIAdd
block|{
specifier|public
name|long
name|init
parameter_list|()
block|{
return|return
literal|0L
return|;
block|}
specifier|public
name|long
name|add
parameter_list|(
name|short
name|accumulator
parameter_list|,
name|int
name|v
parameter_list|)
block|{
return|return
name|accumulator
operator|+
name|v
return|;
block|}
block|}
comment|/** User-defined table-macro function. */
specifier|public
specifier|static
class|class
name|TableMacroFunction
block|{
specifier|public
name|TranslatableTable
name|eval
parameter_list|(
name|String
name|s
parameter_list|)
block|{
return|return
name|view
argument_list|(
name|s
argument_list|)
return|;
block|}
block|}
comment|/** User-defined table-macro function whose eval method is static. */
specifier|public
specifier|static
class|class
name|StaticTableMacroFunction
block|{
specifier|public
specifier|static
name|TranslatableTable
name|eval
parameter_list|(
name|String
name|s
parameter_list|)
block|{
return|return
name|view
argument_list|(
name|s
argument_list|)
return|;
block|}
block|}
comment|/** User-defined table-macro function with named and optional parameters. */
specifier|public
specifier|static
class|class
name|TableMacroFunctionWithNamedParameters
block|{
specifier|public
name|TranslatableTable
name|eval
parameter_list|(
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"R"
argument_list|,
name|optional
operator|=
literal|true
argument_list|)
name|String
name|r
parameter_list|,
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"S"
argument_list|)
name|String
name|s
parameter_list|,
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"T"
argument_list|,
name|optional
operator|=
literal|true
argument_list|)
name|Integer
name|t
parameter_list|)
block|{
specifier|final
name|StringBuilder
name|sb
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|abc
argument_list|(
name|sb
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|abc
argument_list|(
name|sb
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|abc
argument_list|(
name|sb
argument_list|,
name|t
argument_list|)
expr_stmt|;
return|return
name|view
argument_list|(
name|sb
operator|.
name|toString
argument_list|()
argument_list|)
return|;
block|}
specifier|private
name|void
name|abc
parameter_list|(
name|StringBuilder
name|sb
parameter_list|,
name|Object
name|s
parameter_list|)
block|{
if|if
condition|(
name|s
operator|!=
literal|null
condition|)
block|{
if|if
condition|(
name|sb
operator|.
name|length
argument_list|()
operator|>
literal|0
condition|)
block|{
name|sb
operator|.
name|append
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
block|}
name|sb
operator|.
name|append
argument_list|(
literal|'('
argument_list|)
operator|.
name|append
argument_list|(
name|s
argument_list|)
operator|.
name|append
argument_list|(
literal|')'
argument_list|)
expr_stmt|;
block|}
block|}
block|}
comment|/** A table function that returns a {@link QueryableTable}. */
specifier|public
specifier|static
class|class
name|MyTableFunction
block|{
specifier|public
name|QueryableTable
name|eval
parameter_list|(
name|String
name|s
parameter_list|)
block|{
return|return
name|oneThreePlus
argument_list|(
name|s
argument_list|)
return|;
block|}
block|}
comment|/** A table function that returns a {@link QueryableTable} via a    * static method. */
specifier|public
specifier|static
class|class
name|TestStaticTableFunction
block|{
specifier|public
specifier|static
name|QueryableTable
name|eval
parameter_list|(
name|String
name|s
parameter_list|)
block|{
return|return
name|oneThreePlus
argument_list|(
name|s
argument_list|)
return|;
block|}
block|}
comment|/** The real MazeTable may be found in example/function. This is a cut-down    * version to support a test. */
specifier|public
specifier|static
class|class
name|MazeTable
extends|extends
name|AbstractTable
implements|implements
name|ScannableTable
block|{
specifier|private
specifier|final
name|String
name|content
decl_stmt|;
specifier|public
name|MazeTable
parameter_list|(
name|String
name|content
parameter_list|)
block|{
name|this
operator|.
name|content
operator|=
name|content
expr_stmt|;
block|}
specifier|public
specifier|static
name|ScannableTable
name|generate
parameter_list|(
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|seed
parameter_list|)
block|{
return|return
operator|new
name|MazeTable
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"generate(w=%d, h=%d, s=%d)"
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|seed
argument_list|)
argument_list|)
return|;
block|}
specifier|public
specifier|static
name|ScannableTable
name|generate2
parameter_list|(
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"WIDTH"
argument_list|)
name|int
name|width
parameter_list|,
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"HEIGHT"
argument_list|)
name|int
name|height
parameter_list|,
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"SEED"
argument_list|,
name|optional
operator|=
literal|true
argument_list|)
name|Integer
name|seed
parameter_list|)
block|{
return|return
operator|new
name|MazeTable
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"generate2(w=%d, h=%d, s=%d)"
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|seed
argument_list|)
argument_list|)
return|;
block|}
specifier|public
specifier|static
name|ScannableTable
name|generate3
parameter_list|(
annotation|@
name|Parameter
argument_list|(
name|name
operator|=
literal|"FOO"
argument_list|)
name|String
name|foo
parameter_list|)
block|{
return|return
operator|new
name|MazeTable
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"generate3(foo=%s)"
argument_list|,
name|foo
argument_list|)
argument_list|)
return|;
block|}
specifier|public
name|RelDataType
name|getRowType
parameter_list|(
name|RelDataTypeFactory
name|typeFactory
parameter_list|)
block|{
return|return
name|typeFactory
operator|.
name|builder
argument_list|()
operator|.
name|add
argument_list|(
literal|"S"
argument_list|,
name|SqlTypeName
operator|.
name|VARCHAR
argument_list|,
literal|12
argument_list|)
operator|.
name|build
argument_list|()
return|;
block|}
specifier|public
name|Enumerable
argument_list|<
name|Object
index|[]
argument_list|>
name|scan
parameter_list|(
name|DataContext
name|root
parameter_list|)
block|{
name|Object
index|[]
index|[]
name|rows
init|=
block|{
block|{
literal|"abcde"
block|}
block|,
block|{
literal|"xyz"
block|}
block|,
block|{
name|content
block|}
block|}
decl_stmt|;
return|return
name|Linq4j
operator|.
name|asEnumerable
argument_list|(
name|rows
argument_list|)
return|;
block|}
block|}
block|}
end_class

begin_comment
comment|// End Smalls.java
end_comment

end_unit

