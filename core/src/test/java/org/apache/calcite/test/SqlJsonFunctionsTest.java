begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * Licensed to the Apache Software Foundation (ASF) under one or more  * contributor license agreements.  See the NOTICE file distributed with  * this work for additional information regarding copyright ownership.  * The ASF licenses this file to you under the Apache License, Version 2.0  * (the "License"); you may not use this file except in compliance with  * the License.  You may obtain a copy of the License at  *  * http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|test
package|;
end_package

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|runtime
operator|.
name|CalciteException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|runtime
operator|.
name|JsonFunctions
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|runtime
operator|.
name|SqlFunctions
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|sql
operator|.
name|SqlJsonConstructorNullClause
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|sql
operator|.
name|SqlJsonExistsErrorBehavior
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|sql
operator|.
name|SqlJsonQueryEmptyOrErrorBehavior
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|sql
operator|.
name|SqlJsonQueryWrapperBehavior
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|sql
operator|.
name|SqlJsonValueEmptyOrErrorBehavior
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|util
operator|.
name|BuiltInMethod
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|primitives
operator|.
name|Longs
import|;
end_import

begin_import
import|import
name|com
operator|.
name|jayway
operator|.
name|jsonpath
operator|.
name|InvalidJsonException
import|;
end_import

begin_import
import|import
name|com
operator|.
name|jayway
operator|.
name|jsonpath
operator|.
name|PathNotFoundException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|hamcrest
operator|.
name|BaseMatcher
import|;
end_import

begin_import
import|import
name|org
operator|.
name|hamcrest
operator|.
name|Description
import|;
end_import

begin_import
import|import
name|org
operator|.
name|hamcrest
operator|.
name|Matcher
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|jupiter
operator|.
name|api
operator|.
name|Test
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Arrays
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collections
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Objects
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|function
operator|.
name|Supplier
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|stream
operator|.
name|Collectors
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|hamcrest
operator|.
name|CoreMatchers
operator|.
name|is
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|hamcrest
operator|.
name|CoreMatchers
operator|.
name|nullValue
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|hamcrest
operator|.
name|MatcherAssert
operator|.
name|assertThat
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|jupiter
operator|.
name|api
operator|.
name|Assertions
operator|.
name|fail
import|;
end_import

begin_comment
comment|/**  * Unit test for the methods in {@link SqlFunctions} that implement JSON processing functions.  */
end_comment

begin_class
class|class
name|SqlJsonFunctionsTest
block|{
annotation|@
name|Test
name|void
name|testJsonValueExpression
parameter_list|()
block|{
name|assertJsonValueExpression
argument_list|(
literal|"{}"
argument_list|,
name|is
argument_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
operator|.
name|withJavaObj
argument_list|(
name|Collections
operator|.
name|emptyMap
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonNullExpression
parameter_list|()
block|{
name|assertJsonValueExpression
argument_list|(
literal|"null"
argument_list|,
name|is
argument_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
operator|.
name|withJavaObj
argument_list|(
literal|null
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonApiCommonSyntax
parameter_list|()
block|{
name|assertJsonApiCommonSyntax
argument_list|(
literal|"{\"foo\": \"bar\"}"
argument_list|,
literal|"$.foo"
argument_list|,
name|contextMatches
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
literal|"bar"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonApiCommonSyntax
argument_list|(
literal|"{\"foo\": \"bar\"}"
argument_list|,
literal|"lax $.foo"
argument_list|,
name|contextMatches
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|"bar"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonApiCommonSyntax
argument_list|(
literal|"{\"foo\": \"bar\"}"
argument_list|,
literal|"strict $.foo"
argument_list|,
name|contextMatches
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
literal|"bar"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonApiCommonSyntax
argument_list|(
literal|"{\"foo\": \"bar\"}"
argument_list|,
literal|"lax $.foo1"
argument_list|,
name|contextMatches
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonApiCommonSyntax
argument_list|(
literal|"{\"foo\": \"bar\"}"
argument_list|,
literal|"strict $.foo1"
argument_list|,
name|contextMatches
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withStrictException
argument_list|(
operator|new
name|PathNotFoundException
argument_list|(
literal|"No results for path: $['foo1']"
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonApiCommonSyntax
argument_list|(
literal|"{\"foo\": 100}"
argument_list|,
literal|"lax $.foo"
argument_list|,
name|contextMatches
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|100
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonExists
parameter_list|()
block|{
name|assertJsonExists
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|FALSE
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonExists
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|TRUE
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonExists
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|UNKNOWN
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonExists
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|ERROR
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonExists
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|FALSE
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonExists
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|TRUE
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonExists
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|UNKNOWN
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonExists
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|ERROR
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonExists
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withStrictException
argument_list|(
operator|new
name|Exception
argument_list|(
literal|"test message"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|FALSE
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonExists
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withStrictException
argument_list|(
operator|new
name|Exception
argument_list|(
literal|"test message"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|TRUE
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonExists
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withStrictException
argument_list|(
operator|new
name|Exception
argument_list|(
literal|"test message"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|UNKNOWN
argument_list|,
name|nullValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertJsonExistsFailed
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withStrictException
argument_list|(
operator|new
name|Exception
argument_list|(
literal|"test message"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonExistsErrorBehavior
operator|.
name|ERROR
argument_list|,
name|errorMatches
argument_list|(
operator|new
name|RuntimeException
argument_list|(
literal|"java.lang.Exception: test message"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonValueAny
parameter_list|()
block|{
name|assertJsonValueAny
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|is
argument_list|(
literal|"bar"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonValueAny
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|nullValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertJsonValueAny
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|DEFAULT
argument_list|,
literal|"empty"
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|is
argument_list|(
literal|"empty"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonValueAnyFailed
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|ERROR
argument_list|,
literal|null
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|errorMatches
argument_list|(
operator|new
name|CalciteException
argument_list|(
literal|"Empty result of JSON_VALUE function is not "
operator|+
literal|"allowed"
argument_list|,
literal|null
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonValueAny
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
name|Collections
operator|.
name|emptyList
argument_list|()
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|nullValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertJsonValueAny
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
name|Collections
operator|.
name|emptyList
argument_list|()
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|DEFAULT
argument_list|,
literal|"empty"
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|is
argument_list|(
literal|"empty"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonValueAnyFailed
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
name|Collections
operator|.
name|emptyList
argument_list|()
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|ERROR
argument_list|,
literal|null
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|errorMatches
argument_list|(
operator|new
name|CalciteException
argument_list|(
literal|"Empty result of JSON_VALUE function is not "
operator|+
literal|"allowed"
argument_list|,
literal|null
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonValueAny
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withStrictException
argument_list|(
operator|new
name|Exception
argument_list|(
literal|"test message"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|nullValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertJsonValueAny
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withStrictException
argument_list|(
operator|new
name|Exception
argument_list|(
literal|"test message"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|DEFAULT
argument_list|,
literal|"empty"
argument_list|,
name|is
argument_list|(
literal|"empty"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonValueAnyFailed
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withStrictException
argument_list|(
operator|new
name|Exception
argument_list|(
literal|"test message"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|ERROR
argument_list|,
literal|null
argument_list|,
name|errorMatches
argument_list|(
operator|new
name|RuntimeException
argument_list|(
literal|"java.lang.Exception: test message"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonValueAny
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
name|Collections
operator|.
name|emptyList
argument_list|()
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|nullValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertJsonValueAny
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
name|Collections
operator|.
name|emptyList
argument_list|()
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|DEFAULT
argument_list|,
literal|"empty"
argument_list|,
name|is
argument_list|(
literal|"empty"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonValueAnyFailed
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
name|Collections
operator|.
name|emptyList
argument_list|()
argument_list|)
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
literal|null
argument_list|,
name|SqlJsonValueEmptyOrErrorBehavior
operator|.
name|ERROR
argument_list|,
literal|null
argument_list|,
name|errorMatches
argument_list|(
operator|new
name|CalciteException
argument_list|(
literal|"Strict jsonpath mode requires scalar value, "
operator|+
literal|"and the actual value is: '[]'"
argument_list|,
literal|null
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonQuery
parameter_list|()
block|{
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
name|Collections
operator|.
name|singletonList
argument_list|(
literal|"bar"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|is
argument_list|(
literal|"[\"bar\"]"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|nullValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|EMPTY_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|is
argument_list|(
literal|"[]"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|EMPTY_OBJECT
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|is
argument_list|(
literal|"{}"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQueryFailed
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|ERROR
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|errorMatches
argument_list|(
operator|new
name|CalciteException
argument_list|(
literal|"Empty result of JSON_QUERY function is not "
operator|+
literal|"allowed"
argument_list|,
literal|null
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|nullValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|EMPTY_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|is
argument_list|(
literal|"[]"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|EMPTY_OBJECT
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|is
argument_list|(
literal|"{}"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQueryFailed
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|ERROR
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|errorMatches
argument_list|(
operator|new
name|CalciteException
argument_list|(
literal|"Empty result of JSON_QUERY function is not "
operator|+
literal|"allowed"
argument_list|,
literal|null
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withStrictException
argument_list|(
operator|new
name|Exception
argument_list|(
literal|"test message"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|EMPTY_ARRAY
argument_list|,
name|is
argument_list|(
literal|"[]"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withStrictException
argument_list|(
operator|new
name|Exception
argument_list|(
literal|"test message"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|EMPTY_OBJECT
argument_list|,
name|is
argument_list|(
literal|"{}"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQueryFailed
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withStrictException
argument_list|(
operator|new
name|Exception
argument_list|(
literal|"test message"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|ERROR
argument_list|,
name|errorMatches
argument_list|(
operator|new
name|RuntimeException
argument_list|(
literal|"java.lang.Exception: test message"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|nullValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|EMPTY_ARRAY
argument_list|,
name|is
argument_list|(
literal|"[]"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQueryFailed
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITHOUT_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|ERROR
argument_list|,
name|errorMatches
argument_list|(
operator|new
name|CalciteException
argument_list|(
literal|"Strict jsonpath mode requires array or "
operator|+
literal|"object value, and the actual value is: 'bar'"
argument_list|,
literal|null
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// wrapper behavior test
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITH_UNCONDITIONAL_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|is
argument_list|(
literal|"[\"bar\"]"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITH_CONDITIONAL_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|is
argument_list|(
literal|"[\"bar\"]"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
name|Collections
operator|.
name|singletonList
argument_list|(
literal|"bar"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITH_UNCONDITIONAL_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|is
argument_list|(
literal|"[[\"bar\"]]"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonQuery
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
name|Collections
operator|.
name|singletonList
argument_list|(
literal|"bar"
argument_list|)
argument_list|)
argument_list|,
name|SqlJsonQueryWrapperBehavior
operator|.
name|WITH_CONDITIONAL_ARRAY
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
operator|.
name|NULL
argument_list|,
name|is
argument_list|(
literal|"[\"bar\"]"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonize
parameter_list|()
block|{
name|assertJsonize
argument_list|(
operator|new
name|HashMap
argument_list|<>
argument_list|()
argument_list|,
name|is
argument_list|(
literal|"{}"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|assertJsonPretty
parameter_list|()
block|{
name|assertJsonPretty
argument_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
operator|.
name|withJavaObj
argument_list|(
operator|new
name|HashMap
argument_list|<>
argument_list|()
argument_list|)
argument_list|,
name|is
argument_list|(
literal|"{ }"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonPretty
argument_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
operator|.
name|withJavaObj
argument_list|(
name|Longs
operator|.
name|asList
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|)
argument_list|)
argument_list|,
name|is
argument_list|(
literal|"[ 1, 2 ]"
argument_list|)
argument_list|)
expr_stmt|;
name|Object
name|input
init|=
operator|new
name|Object
argument_list|()
block|{
specifier|private
specifier|final
name|Object
name|self
init|=
name|this
decl_stmt|;
block|}
decl_stmt|;
name|CalciteException
name|expected
init|=
operator|new
name|CalciteException
argument_list|(
literal|"Cannot serialize object to JSON: '"
operator|+
name|input
operator|+
literal|"'"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|assertJsonPrettyFailed
argument_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
operator|.
name|withJavaObj
argument_list|(
name|input
argument_list|)
argument_list|,
name|errorMatches
argument_list|(
name|expected
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testDejsonize
parameter_list|()
block|{
name|assertDejsonize
argument_list|(
literal|"{}"
argument_list|,
name|is
argument_list|(
name|Collections
operator|.
name|emptyMap
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertDejsonize
argument_list|(
literal|"[]"
argument_list|,
name|is
argument_list|(
name|Collections
operator|.
name|emptyList
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
comment|// expect exception thrown
specifier|final
name|String
name|message
init|=
literal|"com.fasterxml.jackson.core.JsonParseException: "
operator|+
literal|"Unexpected close marker '}': expected ']' (for Array starting at "
operator|+
literal|"[Source: (String)\"[}\"; line: 1, column: 1])\n at [Source: "
operator|+
literal|"(String)\"[}\"; line: 1, column: 3]"
decl_stmt|;
name|assertDejsonizeFailed
argument_list|(
literal|"[}"
argument_list|,
name|errorMatches
argument_list|(
operator|new
name|InvalidJsonException
argument_list|(
name|message
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonObject
parameter_list|()
block|{
name|assertJsonObject
argument_list|(
name|is
argument_list|(
literal|"{}"
argument_list|)
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|NULL_ON_NULL
argument_list|)
expr_stmt|;
name|assertJsonObject
argument_list|(
name|is
argument_list|(
literal|"{\"foo\":\"bar\"}"
argument_list|)
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|NULL_ON_NULL
argument_list|,
literal|"foo"
argument_list|,
literal|"bar"
argument_list|)
expr_stmt|;
name|assertJsonObject
argument_list|(
name|is
argument_list|(
literal|"{\"foo\":null}"
argument_list|)
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|NULL_ON_NULL
argument_list|,
literal|"foo"
argument_list|,
literal|null
argument_list|)
expr_stmt|;
name|assertJsonObject
argument_list|(
name|is
argument_list|(
literal|"{}"
argument_list|)
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|ABSENT_ON_NULL
argument_list|,
literal|"foo"
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonType
parameter_list|()
block|{
name|assertJsonType
argument_list|(
name|is
argument_list|(
literal|"OBJECT"
argument_list|)
argument_list|,
literal|"{}"
argument_list|)
expr_stmt|;
name|assertJsonType
argument_list|(
name|is
argument_list|(
literal|"ARRAY"
argument_list|)
argument_list|,
literal|"[\"foo\",null]"
argument_list|)
expr_stmt|;
name|assertJsonType
argument_list|(
name|is
argument_list|(
literal|"NULL"
argument_list|)
argument_list|,
literal|"null"
argument_list|)
expr_stmt|;
name|assertJsonType
argument_list|(
name|is
argument_list|(
literal|"BOOLEAN"
argument_list|)
argument_list|,
literal|"false"
argument_list|)
expr_stmt|;
name|assertJsonType
argument_list|(
name|is
argument_list|(
literal|"INTEGER"
argument_list|)
argument_list|,
literal|"12"
argument_list|)
expr_stmt|;
name|assertJsonType
argument_list|(
name|is
argument_list|(
literal|"DOUBLE"
argument_list|)
argument_list|,
literal|"11.22"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonDepth
parameter_list|()
block|{
name|assertJsonDepth
argument_list|(
name|is
argument_list|(
literal|1
argument_list|)
argument_list|,
literal|"{}"
argument_list|)
expr_stmt|;
name|assertJsonDepth
argument_list|(
name|is
argument_list|(
literal|1
argument_list|)
argument_list|,
literal|"false"
argument_list|)
expr_stmt|;
name|assertJsonDepth
argument_list|(
name|is
argument_list|(
literal|1
argument_list|)
argument_list|,
literal|"12"
argument_list|)
expr_stmt|;
name|assertJsonDepth
argument_list|(
name|is
argument_list|(
literal|1
argument_list|)
argument_list|,
literal|"11.22"
argument_list|)
expr_stmt|;
name|assertJsonDepth
argument_list|(
name|is
argument_list|(
literal|2
argument_list|)
argument_list|,
literal|"[\"foo\",null]"
argument_list|)
expr_stmt|;
name|assertJsonDepth
argument_list|(
name|is
argument_list|(
literal|3
argument_list|)
argument_list|,
literal|"{\"a\": [10, true]}"
argument_list|)
expr_stmt|;
name|assertJsonDepth
argument_list|(
name|nullValue
argument_list|()
argument_list|,
literal|"null"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonLength
parameter_list|()
block|{
name|assertJsonLength
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
name|Collections
operator|.
name|singletonList
argument_list|(
literal|"bar"
argument_list|)
argument_list|)
argument_list|,
name|is
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonLength
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|nullValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertJsonLength
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
name|Collections
operator|.
name|singletonList
argument_list|(
literal|"bar"
argument_list|)
argument_list|)
argument_list|,
name|is
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonLength
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|is
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonKeys
parameter_list|()
block|{
name|assertJsonKeys
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
name|Collections
operator|.
name|singletonList
argument_list|(
literal|"bar"
argument_list|)
argument_list|)
argument_list|,
name|is
argument_list|(
literal|"null"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonKeys
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|null
argument_list|)
argument_list|,
name|is
argument_list|(
literal|"null"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonKeys
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|STRICT
argument_list|,
name|Collections
operator|.
name|singletonList
argument_list|(
literal|"bar"
argument_list|)
argument_list|)
argument_list|,
name|is
argument_list|(
literal|"null"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonKeys
argument_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|.
name|withJavaObj
argument_list|(
name|JsonFunctions
operator|.
name|PathMode
operator|.
name|LAX
argument_list|,
literal|"bar"
argument_list|)
argument_list|,
name|is
argument_list|(
literal|"null"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonRemove
parameter_list|()
block|{
name|assertJsonRemove
argument_list|(
name|JsonFunctions
operator|.
name|jsonValueExpression
argument_list|(
literal|"{\"a\": 1, \"b\": [2]}"
argument_list|)
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"$.a"
block|}
argument_list|,
name|is
argument_list|(
literal|"{\"b\":[2]}"
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonRemove
argument_list|(
name|JsonFunctions
operator|.
name|jsonValueExpression
argument_list|(
literal|"{\"a\": 1, \"b\": [2]}"
argument_list|)
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"$.a"
block|,
literal|"$.b"
block|}
argument_list|,
name|is
argument_list|(
literal|"{}"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonStorageSize
parameter_list|()
block|{
name|assertJsonStorageSize
argument_list|(
literal|"[100, \"sakila\", [1, 3, 5], 425.05]"
argument_list|,
name|is
argument_list|(
literal|29
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonStorageSize
argument_list|(
literal|"null"
argument_list|,
name|is
argument_list|(
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonStorageSize
argument_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
operator|.
name|withJavaObj
argument_list|(
literal|null
argument_list|)
argument_list|,
name|is
argument_list|(
literal|4
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonObjectAggAdd
parameter_list|()
block|{
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|map
init|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|expected
init|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|expected
operator|.
name|put
argument_list|(
literal|"foo"
argument_list|,
literal|"bar"
argument_list|)
expr_stmt|;
name|assertJsonObjectAggAdd
argument_list|(
name|map
argument_list|,
literal|"foo"
argument_list|,
literal|"bar"
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|NULL_ON_NULL
argument_list|,
name|is
argument_list|(
name|expected
argument_list|)
argument_list|)
expr_stmt|;
name|expected
operator|.
name|put
argument_list|(
literal|"foo1"
argument_list|,
literal|null
argument_list|)
expr_stmt|;
name|assertJsonObjectAggAdd
argument_list|(
name|map
argument_list|,
literal|"foo1"
argument_list|,
literal|null
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|NULL_ON_NULL
argument_list|,
name|is
argument_list|(
name|expected
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonObjectAggAdd
argument_list|(
name|map
argument_list|,
literal|"foo2"
argument_list|,
literal|null
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|ABSENT_ON_NULL
argument_list|,
name|is
argument_list|(
name|expected
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonArray
parameter_list|()
block|{
name|assertJsonArray
argument_list|(
name|is
argument_list|(
literal|"[]"
argument_list|)
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|NULL_ON_NULL
argument_list|)
expr_stmt|;
name|assertJsonArray
argument_list|(
name|is
argument_list|(
literal|"[\"foo\"]"
argument_list|)
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|NULL_ON_NULL
argument_list|,
literal|"foo"
argument_list|)
expr_stmt|;
name|assertJsonArray
argument_list|(
name|is
argument_list|(
literal|"[\"foo\",null]"
argument_list|)
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|NULL_ON_NULL
argument_list|,
literal|"foo"
argument_list|,
literal|null
argument_list|)
expr_stmt|;
name|assertJsonArray
argument_list|(
name|is
argument_list|(
literal|"[\"foo\"]"
argument_list|)
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|ABSENT_ON_NULL
argument_list|,
literal|"foo"
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonArrayAggAdd
parameter_list|()
block|{
name|List
argument_list|<
name|Object
argument_list|>
name|list
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|Object
argument_list|>
name|expected
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|()
decl_stmt|;
name|expected
operator|.
name|add
argument_list|(
literal|"foo"
argument_list|)
expr_stmt|;
name|assertJsonArrayAggAdd
argument_list|(
name|list
argument_list|,
literal|"foo"
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|NULL_ON_NULL
argument_list|,
name|is
argument_list|(
name|expected
argument_list|)
argument_list|)
expr_stmt|;
name|expected
operator|.
name|add
argument_list|(
literal|null
argument_list|)
expr_stmt|;
name|assertJsonArrayAggAdd
argument_list|(
name|list
argument_list|,
literal|null
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|NULL_ON_NULL
argument_list|,
name|is
argument_list|(
name|expected
argument_list|)
argument_list|)
expr_stmt|;
name|assertJsonArrayAggAdd
argument_list|(
name|list
argument_list|,
literal|null
argument_list|,
name|SqlJsonConstructorNullClause
operator|.
name|ABSENT_ON_NULL
argument_list|,
name|is
argument_list|(
name|expected
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
name|void
name|testJsonPredicate
parameter_list|()
block|{
name|assertIsJsonValue
argument_list|(
literal|"[]"
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonValue
argument_list|(
literal|"{}"
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonValue
argument_list|(
literal|"100"
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonValue
argument_list|(
literal|"{]"
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonObject
argument_list|(
literal|"[]"
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonObject
argument_list|(
literal|"{}"
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonObject
argument_list|(
literal|"100"
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonObject
argument_list|(
literal|"{]"
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonArray
argument_list|(
literal|"[]"
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonArray
argument_list|(
literal|"{}"
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonArray
argument_list|(
literal|"100"
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonArray
argument_list|(
literal|"{]"
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonScalar
argument_list|(
literal|"[]"
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonScalar
argument_list|(
literal|"{}"
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonScalar
argument_list|(
literal|"100"
argument_list|,
name|is
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|assertIsJsonScalar
argument_list|(
literal|"{]"
argument_list|,
name|is
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonValueExpression
parameter_list|(
name|String
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|JsonFunctions
operator|.
name|JsonValueContext
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_VALUE_EXPRESSION
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonValueExpression
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonApiCommonSyntax
parameter_list|(
name|String
name|input
parameter_list|,
name|String
name|pathSpec
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|JsonFunctions
operator|.
name|JsonPathContext
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_API_COMMON_SYNTAX
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|,
name|pathSpec
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonApiCommonSyntax
argument_list|(
name|input
argument_list|,
name|pathSpec
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonApiCommonSyntax
parameter_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
name|input
parameter_list|,
name|String
name|pathSpec
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|JsonFunctions
operator|.
name|JsonPathContext
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_API_COMMON_SYNTAX
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|,
name|pathSpec
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonApiCommonSyntax
argument_list|(
name|input
argument_list|,
name|pathSpec
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonExists
parameter_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
name|context
parameter_list|,
name|SqlJsonExistsErrorBehavior
name|errorBehavior
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Boolean
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_EXISTS
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|context
argument_list|,
name|errorBehavior
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonExists
argument_list|(
name|context
argument_list|,
name|errorBehavior
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonExistsFailed
parameter_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
name|context
parameter_list|,
name|SqlJsonExistsErrorBehavior
name|errorBehavior
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Throwable
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertFailed
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_EXISTS
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|context
argument_list|,
name|errorBehavior
argument_list|)
argument_list|,
parameter_list|()
lambda|->
name|JsonFunctions
operator|.
name|jsonExists
argument_list|(
name|context
argument_list|,
name|errorBehavior
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonValueAny
parameter_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
name|context
parameter_list|,
name|SqlJsonValueEmptyOrErrorBehavior
name|emptyBehavior
parameter_list|,
name|Object
name|defaultValueOnEmpty
parameter_list|,
name|SqlJsonValueEmptyOrErrorBehavior
name|errorBehavior
parameter_list|,
name|Object
name|defaultValueOnError
parameter_list|,
name|Matcher
argument_list|<
name|Object
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_VALUE
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|context
argument_list|,
name|emptyBehavior
argument_list|,
name|defaultValueOnEmpty
argument_list|,
name|errorBehavior
argument_list|,
name|defaultValueOnError
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonValue
argument_list|(
name|context
argument_list|,
name|emptyBehavior
argument_list|,
name|defaultValueOnEmpty
argument_list|,
name|errorBehavior
argument_list|,
name|defaultValueOnError
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonValueAnyFailed
parameter_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
name|input
parameter_list|,
name|SqlJsonValueEmptyOrErrorBehavior
name|emptyBehavior
parameter_list|,
name|Object
name|defaultValueOnEmpty
parameter_list|,
name|SqlJsonValueEmptyOrErrorBehavior
name|errorBehavior
parameter_list|,
name|Object
name|defaultValueOnError
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Throwable
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertFailed
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_VALUE
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|,
name|emptyBehavior
argument_list|,
name|defaultValueOnEmpty
argument_list|,
name|errorBehavior
argument_list|,
name|defaultValueOnError
argument_list|)
argument_list|,
parameter_list|()
lambda|->
name|JsonFunctions
operator|.
name|jsonValue
argument_list|(
name|input
argument_list|,
name|emptyBehavior
argument_list|,
name|defaultValueOnEmpty
argument_list|,
name|errorBehavior
argument_list|,
name|defaultValueOnError
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonQuery
parameter_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
name|input
parameter_list|,
name|SqlJsonQueryWrapperBehavior
name|wrapperBehavior
parameter_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
name|emptyBehavior
parameter_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
name|errorBehavior
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|String
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_QUERY
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|,
name|wrapperBehavior
argument_list|,
name|emptyBehavior
argument_list|,
name|errorBehavior
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonQuery
argument_list|(
name|input
argument_list|,
name|wrapperBehavior
argument_list|,
name|emptyBehavior
argument_list|,
name|errorBehavior
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonQueryFailed
parameter_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
name|input
parameter_list|,
name|SqlJsonQueryWrapperBehavior
name|wrapperBehavior
parameter_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
name|emptyBehavior
parameter_list|,
name|SqlJsonQueryEmptyOrErrorBehavior
name|errorBehavior
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Throwable
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertFailed
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_QUERY
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|,
name|wrapperBehavior
argument_list|,
name|emptyBehavior
argument_list|,
name|errorBehavior
argument_list|)
argument_list|,
parameter_list|()
lambda|->
name|JsonFunctions
operator|.
name|jsonQuery
argument_list|(
name|input
argument_list|,
name|wrapperBehavior
argument_list|,
name|emptyBehavior
argument_list|,
name|errorBehavior
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonize
parameter_list|(
name|Object
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|String
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSONIZE
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonize
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonPretty
parameter_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|String
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_PRETTY
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonPretty
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonPrettyFailed
parameter_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Throwable
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertFailed
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_PRETTY
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
parameter_list|()
lambda|->
name|JsonFunctions
operator|.
name|jsonPretty
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonLength
parameter_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Integer
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_LENGTH
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonLength
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonLengthFailed
parameter_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Throwable
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertFailed
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_LENGTH
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
parameter_list|()
lambda|->
name|JsonFunctions
operator|.
name|jsonLength
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonKeys
parameter_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|String
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_KEYS
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonKeys
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonKeysFailed
parameter_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Throwable
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertFailed
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_KEYS
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
parameter_list|()
lambda|->
name|JsonFunctions
operator|.
name|jsonKeys
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonRemove
parameter_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
name|input
parameter_list|,
name|String
index|[]
name|pathSpecs
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|String
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_REMOVE
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|,
name|pathSpecs
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonRemove
argument_list|(
name|input
argument_list|,
name|pathSpecs
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonStorageSize
parameter_list|(
name|String
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Integer
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_STORAGE_SIZE
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonStorageSize
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonStorageSize
parameter_list|(
name|JsonFunctions
operator|.
name|JsonValueContext
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Integer
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_STORAGE_SIZE
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonStorageSize
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonStorageSizeFailed
parameter_list|(
name|String
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Throwable
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertFailed
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_STORAGE_SIZE
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
parameter_list|()
lambda|->
name|JsonFunctions
operator|.
name|jsonStorageSize
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertDejsonize
parameter_list|(
name|String
name|input
parameter_list|,
name|Matcher
argument_list|<
name|Object
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|DEJSONIZE
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|dejsonize
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertDejsonizeFailed
parameter_list|(
name|String
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Throwable
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertFailed
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|DEJSONIZE
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
parameter_list|()
lambda|->
name|JsonFunctions
operator|.
name|dejsonize
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonObject
parameter_list|(
name|Matcher
argument_list|<
name|?
super|super
name|String
argument_list|>
name|matcher
parameter_list|,
name|SqlJsonConstructorNullClause
name|nullClause
parameter_list|,
name|Object
modifier|...
name|kvs
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_OBJECT
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|nullClause
argument_list|,
name|kvs
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonObject
argument_list|(
name|nullClause
argument_list|,
name|kvs
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonType
parameter_list|(
name|Matcher
argument_list|<
name|?
super|super
name|String
argument_list|>
name|matcher
parameter_list|,
name|String
name|input
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_TYPE
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonType
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonDepth
parameter_list|(
name|Matcher
argument_list|<
name|?
super|super
name|Integer
argument_list|>
name|matcher
parameter_list|,
name|String
name|input
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_DEPTH
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonDepth
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonObjectAggAdd
parameter_list|(
name|Map
name|map
parameter_list|,
name|String
name|k
parameter_list|,
name|Object
name|v
parameter_list|,
name|SqlJsonConstructorNullClause
name|nullClause
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Map
argument_list|>
name|matcher
parameter_list|)
block|{
name|JsonFunctions
operator|.
name|jsonObjectAggAdd
argument_list|(
name|map
argument_list|,
name|k
argument_list|,
name|v
argument_list|,
name|nullClause
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_ARRAYAGG_ADD
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|map
argument_list|,
name|k
argument_list|,
name|v
argument_list|,
name|nullClause
argument_list|)
argument_list|,
name|map
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonArray
parameter_list|(
name|Matcher
argument_list|<
name|?
super|super
name|String
argument_list|>
name|matcher
parameter_list|,
name|SqlJsonConstructorNullClause
name|nullClause
parameter_list|,
name|Object
modifier|...
name|elements
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_ARRAY
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|nullClause
argument_list|,
name|elements
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|jsonArray
argument_list|(
name|nullClause
argument_list|,
name|elements
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertJsonArrayAggAdd
parameter_list|(
name|List
name|list
parameter_list|,
name|Object
name|element
parameter_list|,
name|SqlJsonConstructorNullClause
name|nullClause
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|List
argument_list|>
name|matcher
parameter_list|)
block|{
name|JsonFunctions
operator|.
name|jsonArrayAggAdd
argument_list|(
name|list
argument_list|,
name|element
argument_list|,
name|nullClause
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|JSON_ARRAYAGG_ADD
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|list
argument_list|,
name|element
argument_list|,
name|nullClause
argument_list|)
argument_list|,
name|list
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertIsJsonValue
parameter_list|(
name|String
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Boolean
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|IS_JSON_VALUE
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|isJsonValue
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertIsJsonScalar
parameter_list|(
name|String
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Boolean
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|IS_JSON_SCALAR
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|isJsonScalar
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertIsJsonArray
parameter_list|(
name|String
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Boolean
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|IS_JSON_ARRAY
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|isJsonArray
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertIsJsonObject
parameter_list|(
name|String
name|input
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Boolean
argument_list|>
name|matcher
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|(
name|BuiltInMethod
operator|.
name|IS_JSON_OBJECT
operator|.
name|getMethodName
argument_list|()
argument_list|,
name|input
argument_list|)
argument_list|,
name|JsonFunctions
operator|.
name|isJsonObject
argument_list|(
name|input
argument_list|)
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
specifier|private
name|String
name|invocationDesc
parameter_list|(
name|String
name|methodName
parameter_list|,
name|Object
modifier|...
name|args
parameter_list|)
block|{
return|return
name|methodName
operator|+
literal|"("
operator|+
name|String
operator|.
name|join
argument_list|(
literal|", "
argument_list|,
name|Arrays
operator|.
name|stream
argument_list|(
name|args
argument_list|)
operator|.
name|map
argument_list|(
name|Objects
operator|::
name|toString
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
argument_list|)
operator|+
literal|")"
return|;
block|}
specifier|private
name|void
name|assertFailed
parameter_list|(
name|String
name|invocationDesc
parameter_list|,
name|Supplier
argument_list|<
name|?
argument_list|>
name|supplier
parameter_list|,
name|Matcher
argument_list|<
name|?
super|super
name|Throwable
argument_list|>
name|matcher
parameter_list|)
block|{
try|try
block|{
name|supplier
operator|.
name|get
argument_list|()
expr_stmt|;
name|fail
argument_list|(
literal|"expect exception, but not: "
operator|+
name|invocationDesc
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Throwable
name|t
parameter_list|)
block|{
name|assertThat
argument_list|(
name|invocationDesc
argument_list|,
name|t
argument_list|,
name|matcher
argument_list|)
expr_stmt|;
block|}
block|}
specifier|private
name|Matcher
argument_list|<
name|?
super|super
name|Throwable
argument_list|>
name|errorMatches
parameter_list|(
name|Throwable
name|expected
parameter_list|)
block|{
return|return
operator|new
name|BaseMatcher
argument_list|<
name|Throwable
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|boolean
name|matches
parameter_list|(
name|Object
name|item
parameter_list|)
block|{
if|if
condition|(
operator|!
operator|(
name|item
operator|instanceof
name|Throwable
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
name|Throwable
name|error
init|=
operator|(
name|Throwable
operator|)
name|item
decl_stmt|;
return|return
name|expected
operator|!=
literal|null
operator|&&
name|Objects
operator|.
name|equals
argument_list|(
name|error
operator|.
name|getClass
argument_list|()
argument_list|,
name|expected
operator|.
name|getClass
argument_list|()
argument_list|)
operator|&&
name|Objects
operator|.
name|equals
argument_list|(
name|error
operator|.
name|getMessage
argument_list|()
argument_list|,
name|expected
operator|.
name|getMessage
argument_list|()
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|void
name|describeTo
parameter_list|(
name|Description
name|description
parameter_list|)
block|{
name|description
operator|.
name|appendText
argument_list|(
literal|"is "
argument_list|)
operator|.
name|appendText
argument_list|(
name|expected
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
return|;
block|}
specifier|private
name|BaseMatcher
argument_list|<
name|JsonFunctions
operator|.
name|JsonPathContext
argument_list|>
name|contextMatches
parameter_list|(
name|JsonFunctions
operator|.
name|JsonPathContext
name|expected
parameter_list|)
block|{
return|return
operator|new
name|BaseMatcher
argument_list|<
name|JsonFunctions
operator|.
name|JsonPathContext
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|boolean
name|matches
parameter_list|(
name|Object
name|item
parameter_list|)
block|{
if|if
condition|(
operator|!
operator|(
name|item
operator|instanceof
name|JsonFunctions
operator|.
name|JsonPathContext
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
name|JsonFunctions
operator|.
name|JsonPathContext
name|context
init|=
operator|(
name|JsonFunctions
operator|.
name|JsonPathContext
operator|)
name|item
decl_stmt|;
if|if
condition|(
name|Objects
operator|.
name|equals
argument_list|(
name|context
operator|.
name|mode
argument_list|,
name|expected
operator|.
name|mode
argument_list|)
operator|&&
name|Objects
operator|.
name|equals
argument_list|(
name|context
operator|.
name|obj
argument_list|,
name|expected
operator|.
name|obj
argument_list|)
condition|)
block|{
if|if
condition|(
name|context
operator|.
name|exc
operator|==
literal|null
operator|&&
name|expected
operator|.
name|exc
operator|==
literal|null
condition|)
block|{
return|return
literal|true
return|;
block|}
return|return
name|context
operator|.
name|exc
operator|!=
literal|null
operator|&&
name|expected
operator|.
name|exc
operator|!=
literal|null
operator|&&
name|Objects
operator|.
name|equals
argument_list|(
name|context
operator|.
name|exc
operator|.
name|getClass
argument_list|()
argument_list|,
name|expected
operator|.
name|exc
operator|.
name|getClass
argument_list|()
argument_list|)
operator|&&
name|Objects
operator|.
name|equals
argument_list|(
name|context
operator|.
name|exc
operator|.
name|getMessage
argument_list|()
argument_list|,
name|expected
operator|.
name|exc
operator|.
name|getMessage
argument_list|()
argument_list|)
return|;
block|}
return|return
literal|false
return|;
block|}
annotation|@
name|Override
specifier|public
name|void
name|describeTo
parameter_list|(
name|Description
name|description
parameter_list|)
block|{
name|description
operator|.
name|appendText
argument_list|(
literal|"is "
argument_list|)
operator|.
name|appendText
argument_list|(
name|expected
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
return|;
block|}
block|}
end_class

end_unit

