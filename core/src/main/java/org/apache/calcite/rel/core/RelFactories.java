begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * Licensed to the Apache Software Foundation (ASF) under one or more  * contributor license agreements.  See the NOTICE file distributed with  * this work for additional information regarding copyright ownership.  * The ASF licenses this file to you under the Apache License, Version 2.0  * (the "License"); you may not use this file except in compliance with  * the License.  You may obtain a copy of the License at  *  * http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|core
package|;
end_package

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|linq4j
operator|.
name|function
operator|.
name|Experimental
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|plan
operator|.
name|Contexts
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|plan
operator|.
name|RelOptCluster
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|plan
operator|.
name|RelOptTable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|plan
operator|.
name|RelTraitSet
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|plan
operator|.
name|ViewExpanders
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|RelCollation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|RelDistribution
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|RelNode
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|hint
operator|.
name|RelHint
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalAggregate
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalCorrelate
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalExchange
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalFilter
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalIntersect
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalJoin
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalMatch
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalMinus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalProject
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalRepeatUnion
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalSnapshot
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalSort
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalSortExchange
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalTableFunctionScan
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalTableScan
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalTableSpool
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalUnion
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|logical
operator|.
name|LogicalValues
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|metadata
operator|.
name|RelColumnMapping
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rel
operator|.
name|type
operator|.
name|RelDataType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rex
operator|.
name|RexLiteral
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|rex
operator|.
name|RexNode
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|schema
operator|.
name|TranslatableTable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|sql
operator|.
name|SqlKind
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|tools
operator|.
name|RelBuilder
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|tools
operator|.
name|RelBuilderFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|calcite
operator|.
name|util
operator|.
name|ImmutableBitSet
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|ImmutableList
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|ImmutableSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Type
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|SortedSet
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|annotation
operator|.
name|Nonnull
import|;
end_import

begin_comment
comment|/**  * Contains factory interface and default implementation for creating various  * rel nodes.  */
end_comment

begin_class
specifier|public
class|class
name|RelFactories
block|{
specifier|public
specifier|static
specifier|final
name|ProjectFactory
name|DEFAULT_PROJECT_FACTORY
init|=
operator|new
name|ProjectFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|FilterFactory
name|DEFAULT_FILTER_FACTORY
init|=
operator|new
name|FilterFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|JoinFactory
name|DEFAULT_JOIN_FACTORY
init|=
operator|new
name|JoinFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|CorrelateFactory
name|DEFAULT_CORRELATE_FACTORY
init|=
operator|new
name|CorrelateFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|SortFactory
name|DEFAULT_SORT_FACTORY
init|=
operator|new
name|SortFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|ExchangeFactory
name|DEFAULT_EXCHANGE_FACTORY
init|=
operator|new
name|ExchangeFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|SortExchangeFactory
name|DEFAULT_SORT_EXCHANGE_FACTORY
init|=
operator|new
name|SortExchangeFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|AggregateFactory
name|DEFAULT_AGGREGATE_FACTORY
init|=
operator|new
name|AggregateFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|MatchFactory
name|DEFAULT_MATCH_FACTORY
init|=
operator|new
name|MatchFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|SetOpFactory
name|DEFAULT_SET_OP_FACTORY
init|=
operator|new
name|SetOpFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|ValuesFactory
name|DEFAULT_VALUES_FACTORY
init|=
operator|new
name|ValuesFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|TableScanFactory
name|DEFAULT_TABLE_SCAN_FACTORY
init|=
operator|new
name|TableScanFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|TableFunctionScanFactory
name|DEFAULT_TABLE_FUNCTION_SCAN_FACTORY
init|=
operator|new
name|TableFunctionScanFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|SnapshotFactory
name|DEFAULT_SNAPSHOT_FACTORY
init|=
operator|new
name|SnapshotFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|SpoolFactory
name|DEFAULT_SPOOL_FACTORY
init|=
operator|new
name|SpoolFactoryImpl
argument_list|()
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|RepeatUnionFactory
name|DEFAULT_REPEAT_UNION_FACTORY
init|=
operator|new
name|RepeatUnionFactoryImpl
argument_list|()
decl_stmt|;
comment|/** A {@link RelBuilderFactory} that creates a {@link RelBuilder} that will    * create logical relational expressions for everything. */
specifier|public
specifier|static
specifier|final
name|RelBuilderFactory
name|LOGICAL_BUILDER
init|=
name|RelBuilder
operator|.
name|proto
argument_list|(
name|Contexts
operator|.
name|of
argument_list|(
name|DEFAULT_PROJECT_FACTORY
argument_list|,
name|DEFAULT_FILTER_FACTORY
argument_list|,
name|DEFAULT_JOIN_FACTORY
argument_list|,
name|DEFAULT_SORT_FACTORY
argument_list|,
name|DEFAULT_EXCHANGE_FACTORY
argument_list|,
name|DEFAULT_SORT_EXCHANGE_FACTORY
argument_list|,
name|DEFAULT_AGGREGATE_FACTORY
argument_list|,
name|DEFAULT_MATCH_FACTORY
argument_list|,
name|DEFAULT_SET_OP_FACTORY
argument_list|,
name|DEFAULT_VALUES_FACTORY
argument_list|,
name|DEFAULT_TABLE_SCAN_FACTORY
argument_list|,
name|DEFAULT_SNAPSHOT_FACTORY
argument_list|,
name|DEFAULT_SPOOL_FACTORY
argument_list|,
name|DEFAULT_REPEAT_UNION_FACTORY
argument_list|)
argument_list|)
decl_stmt|;
specifier|private
name|RelFactories
parameter_list|()
block|{
block|}
comment|/**    * Can create a    * {@link org.apache.calcite.rel.logical.LogicalProject} of the    * appropriate type for this rule's calling convention.    */
specifier|public
interface|interface
name|ProjectFactory
block|{
comment|/**      * Creates a project.      *      * @param input The input      * @param hints The hints      * @param childExprs The projection expressions      * @param fieldNames The projection field names      * @return a project      */
name|RelNode
name|createProject
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|List
argument_list|<
name|RelHint
argument_list|>
name|hints
parameter_list|,
name|List
argument_list|<
name|?
extends|extends
name|RexNode
argument_list|>
name|childExprs
parameter_list|,
name|List
argument_list|<
name|String
argument_list|>
name|fieldNames
parameter_list|)
function_decl|;
annotation|@
name|Deprecated
comment|// to be removed before 1.23
specifier|default
name|RelNode
name|createProject
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|List
argument_list|<
name|?
extends|extends
name|RexNode
argument_list|>
name|childExprs
parameter_list|,
name|List
argument_list|<
name|String
argument_list|>
name|fieldNames
parameter_list|)
block|{
return|return
name|createProject
argument_list|(
name|input
argument_list|,
name|ImmutableList
operator|.
name|of
argument_list|()
argument_list|,
name|childExprs
argument_list|,
name|fieldNames
argument_list|)
return|;
block|}
block|}
comment|/**    * Implementation of {@link ProjectFactory} that returns a vanilla    * {@link org.apache.calcite.rel.logical.LogicalProject}.    */
specifier|private
specifier|static
class|class
name|ProjectFactoryImpl
implements|implements
name|ProjectFactory
block|{
specifier|public
name|RelNode
name|createProject
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|List
argument_list|<
name|RelHint
argument_list|>
name|hints
parameter_list|,
name|List
argument_list|<
name|?
extends|extends
name|RexNode
argument_list|>
name|childExprs
parameter_list|,
name|List
argument_list|<
name|String
argument_list|>
name|fieldNames
parameter_list|)
block|{
return|return
name|LogicalProject
operator|.
name|create
argument_list|(
name|input
argument_list|,
name|hints
argument_list|,
name|childExprs
argument_list|,
name|fieldNames
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a {@link Sort} of the appropriate type    * for this rule's calling convention.    */
specifier|public
interface|interface
name|SortFactory
block|{
comment|/** Creates a sort. */
name|RelNode
name|createSort
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RelCollation
name|collation
parameter_list|,
name|RexNode
name|offset
parameter_list|,
name|RexNode
name|fetch
parameter_list|)
function_decl|;
annotation|@
name|Deprecated
comment|// to be removed before 2.0
specifier|default
name|RelNode
name|createSort
parameter_list|(
name|RelTraitSet
name|traitSet
parameter_list|,
name|RelNode
name|input
parameter_list|,
name|RelCollation
name|collation
parameter_list|,
name|RexNode
name|offset
parameter_list|,
name|RexNode
name|fetch
parameter_list|)
block|{
return|return
name|createSort
argument_list|(
name|input
argument_list|,
name|collation
argument_list|,
name|offset
argument_list|,
name|fetch
argument_list|)
return|;
block|}
block|}
comment|/**    * Implementation of {@link RelFactories.SortFactory} that    * returns a vanilla {@link Sort}.    */
specifier|private
specifier|static
class|class
name|SortFactoryImpl
implements|implements
name|SortFactory
block|{
specifier|public
name|RelNode
name|createSort
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RelCollation
name|collation
parameter_list|,
name|RexNode
name|offset
parameter_list|,
name|RexNode
name|fetch
parameter_list|)
block|{
return|return
name|LogicalSort
operator|.
name|create
argument_list|(
name|input
argument_list|,
name|collation
argument_list|,
name|offset
argument_list|,
name|fetch
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a {@link org.apache.calcite.rel.core.Exchange}    * of the appropriate type for a rule's calling convention.    */
specifier|public
interface|interface
name|ExchangeFactory
block|{
comment|/** Creates a Exchange. */
name|RelNode
name|createExchange
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RelDistribution
name|distribution
parameter_list|)
function_decl|;
block|}
comment|/**    * Implementation of    * {@link RelFactories.ExchangeFactory}    * that returns a {@link Exchange}.    */
specifier|private
specifier|static
class|class
name|ExchangeFactoryImpl
implements|implements
name|ExchangeFactory
block|{
annotation|@
name|Override
specifier|public
name|RelNode
name|createExchange
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RelDistribution
name|distribution
parameter_list|)
block|{
return|return
name|LogicalExchange
operator|.
name|create
argument_list|(
name|input
argument_list|,
name|distribution
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a {@link SortExchange}    * of the appropriate type for a rule's calling convention.    */
specifier|public
interface|interface
name|SortExchangeFactory
block|{
comment|/**      * Creates a {@link SortExchange}.      */
name|RelNode
name|createSortExchange
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RelDistribution
name|distribution
parameter_list|,
name|RelCollation
name|collation
parameter_list|)
function_decl|;
block|}
comment|/**    * Implementation of    * {@link RelFactories.SortExchangeFactory}    * that returns a {@link SortExchange}.    */
specifier|private
specifier|static
class|class
name|SortExchangeFactoryImpl
implements|implements
name|SortExchangeFactory
block|{
annotation|@
name|Override
specifier|public
name|RelNode
name|createSortExchange
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RelDistribution
name|distribution
parameter_list|,
name|RelCollation
name|collation
parameter_list|)
block|{
return|return
name|LogicalSortExchange
operator|.
name|create
argument_list|(
name|input
argument_list|,
name|distribution
argument_list|,
name|collation
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a {@link SetOp} for a particular kind of    * set operation (UNION, EXCEPT, INTERSECT) and of the appropriate type    * for this rule's calling convention.    */
specifier|public
interface|interface
name|SetOpFactory
block|{
comment|/** Creates a set operation. */
name|RelNode
name|createSetOp
parameter_list|(
name|SqlKind
name|kind
parameter_list|,
name|List
argument_list|<
name|RelNode
argument_list|>
name|inputs
parameter_list|,
name|boolean
name|all
parameter_list|)
function_decl|;
block|}
comment|/**    * Implementation of {@link RelFactories.SetOpFactory} that    * returns a vanilla {@link SetOp} for the particular kind of set    * operation (UNION, EXCEPT, INTERSECT).    */
specifier|private
specifier|static
class|class
name|SetOpFactoryImpl
implements|implements
name|SetOpFactory
block|{
specifier|public
name|RelNode
name|createSetOp
parameter_list|(
name|SqlKind
name|kind
parameter_list|,
name|List
argument_list|<
name|RelNode
argument_list|>
name|inputs
parameter_list|,
name|boolean
name|all
parameter_list|)
block|{
switch|switch
condition|(
name|kind
condition|)
block|{
case|case
name|UNION
case|:
return|return
name|LogicalUnion
operator|.
name|create
argument_list|(
name|inputs
argument_list|,
name|all
argument_list|)
return|;
case|case
name|EXCEPT
case|:
return|return
name|LogicalMinus
operator|.
name|create
argument_list|(
name|inputs
argument_list|,
name|all
argument_list|)
return|;
case|case
name|INTERSECT
case|:
return|return
name|LogicalIntersect
operator|.
name|create
argument_list|(
name|inputs
argument_list|,
name|all
argument_list|)
return|;
default|default:
throw|throw
operator|new
name|AssertionError
argument_list|(
literal|"not a set op: "
operator|+
name|kind
argument_list|)
throw|;
block|}
block|}
block|}
comment|/**    * Can create a {@link LogicalAggregate} of the appropriate type    * for this rule's calling convention.    */
specifier|public
interface|interface
name|AggregateFactory
block|{
comment|/** Creates an aggregate. */
name|RelNode
name|createAggregate
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|List
argument_list|<
name|RelHint
argument_list|>
name|hints
parameter_list|,
name|ImmutableBitSet
name|groupSet
parameter_list|,
name|ImmutableList
argument_list|<
name|ImmutableBitSet
argument_list|>
name|groupSets
parameter_list|,
name|List
argument_list|<
name|AggregateCall
argument_list|>
name|aggCalls
parameter_list|)
function_decl|;
annotation|@
name|Deprecated
comment|// to be removed before 1.23
specifier|default
name|RelNode
name|createAggregate
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|ImmutableBitSet
name|groupSet
parameter_list|,
name|ImmutableList
argument_list|<
name|ImmutableBitSet
argument_list|>
name|groupSets
parameter_list|,
name|List
argument_list|<
name|AggregateCall
argument_list|>
name|aggCalls
parameter_list|)
block|{
return|return
name|createAggregate
argument_list|(
name|input
argument_list|,
name|ImmutableList
operator|.
name|of
argument_list|()
argument_list|,
name|groupSet
argument_list|,
name|groupSets
argument_list|,
name|aggCalls
argument_list|)
return|;
block|}
annotation|@
name|Deprecated
comment|// to be removed before 1.23
specifier|default
name|RelNode
name|createAggregate
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|boolean
name|indicator
parameter_list|,
name|ImmutableBitSet
name|groupSet
parameter_list|,
name|ImmutableList
argument_list|<
name|ImmutableBitSet
argument_list|>
name|groupSets
parameter_list|,
name|List
argument_list|<
name|AggregateCall
argument_list|>
name|aggCalls
parameter_list|)
block|{
name|Aggregate
operator|.
name|checkIndicator
argument_list|(
name|indicator
argument_list|)
expr_stmt|;
return|return
name|createAggregate
argument_list|(
name|input
argument_list|,
name|ImmutableList
operator|.
name|of
argument_list|()
argument_list|,
name|groupSet
argument_list|,
name|groupSets
argument_list|,
name|aggCalls
argument_list|)
return|;
block|}
block|}
comment|/**    * Implementation of {@link RelFactories.AggregateFactory}    * that returns a vanilla {@link LogicalAggregate}.    */
specifier|private
specifier|static
class|class
name|AggregateFactoryImpl
implements|implements
name|AggregateFactory
block|{
specifier|public
name|RelNode
name|createAggregate
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|List
argument_list|<
name|RelHint
argument_list|>
name|hints
parameter_list|,
name|ImmutableBitSet
name|groupSet
parameter_list|,
name|ImmutableList
argument_list|<
name|ImmutableBitSet
argument_list|>
name|groupSets
parameter_list|,
name|List
argument_list|<
name|AggregateCall
argument_list|>
name|aggCalls
parameter_list|)
block|{
return|return
name|LogicalAggregate
operator|.
name|create
argument_list|(
name|input
argument_list|,
name|hints
argument_list|,
name|groupSet
argument_list|,
name|groupSets
argument_list|,
name|aggCalls
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a {@link Filter} of the appropriate type    * for this rule's calling convention.    */
specifier|public
interface|interface
name|FilterFactory
block|{
comment|/** Creates a filter.      *      *<p>Some implementations of {@code Filter} do not support correlation      * variables, and for these, this method will throw if {@code variablesSet}      * is not empty.      *      * @param input Input relational expression      * @param condition Filter condition; only rows for which this condition      *   evaluates to TRUE will be emitted      * @param variablesSet Correlating variables that are set when reading      *   a row from the input, and which may be referenced from inside the      *   condition      */
name|RelNode
name|createFilter
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RexNode
name|condition
parameter_list|,
name|Set
argument_list|<
name|CorrelationId
argument_list|>
name|variablesSet
parameter_list|)
function_decl|;
annotation|@
name|Deprecated
comment|// to be removed before 2.0
specifier|default
name|RelNode
name|createFilter
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RexNode
name|condition
parameter_list|)
block|{
return|return
name|createFilter
argument_list|(
name|input
argument_list|,
name|condition
argument_list|,
name|ImmutableSet
operator|.
name|of
argument_list|()
argument_list|)
return|;
block|}
block|}
comment|/**    * Implementation of {@link RelFactories.FilterFactory} that    * returns a vanilla {@link LogicalFilter}.    */
specifier|private
specifier|static
class|class
name|FilterFactoryImpl
implements|implements
name|FilterFactory
block|{
specifier|public
name|RelNode
name|createFilter
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RexNode
name|condition
parameter_list|,
name|Set
argument_list|<
name|CorrelationId
argument_list|>
name|variablesSet
parameter_list|)
block|{
return|return
name|LogicalFilter
operator|.
name|create
argument_list|(
name|input
argument_list|,
name|condition
argument_list|,
name|ImmutableSet
operator|.
name|copyOf
argument_list|(
name|variablesSet
argument_list|)
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a join of the appropriate type for a rule's calling convention.    *    *<p>The result is typically a {@link Join}.    */
specifier|public
interface|interface
name|JoinFactory
block|{
comment|/**      * Creates a join.      *      * @param left             Left input      * @param right            Right input      * @param hints            Hints      * @param condition        Join condition      * @param variablesSet     Set of variables that are set by the      *                         LHS and used by the RHS and are not available to      *                         nodes above this LogicalJoin in the tree      * @param joinType         Join type      * @param semiJoinDone     Whether this join has been translated to a      *                         semi-join      */
name|RelNode
name|createJoin
parameter_list|(
name|RelNode
name|left
parameter_list|,
name|RelNode
name|right
parameter_list|,
name|List
argument_list|<
name|RelHint
argument_list|>
name|hints
parameter_list|,
name|RexNode
name|condition
parameter_list|,
name|Set
argument_list|<
name|CorrelationId
argument_list|>
name|variablesSet
parameter_list|,
name|JoinRelType
name|joinType
parameter_list|,
name|boolean
name|semiJoinDone
parameter_list|)
function_decl|;
annotation|@
name|Deprecated
comment|// to be removed before 1.23
specifier|default
name|RelNode
name|createJoin
parameter_list|(
name|RelNode
name|left
parameter_list|,
name|RelNode
name|right
parameter_list|,
name|RexNode
name|condition
parameter_list|,
name|Set
argument_list|<
name|CorrelationId
argument_list|>
name|variablesSet
parameter_list|,
name|JoinRelType
name|joinType
parameter_list|,
name|boolean
name|semiJoinDone
parameter_list|)
block|{
return|return
name|createJoin
argument_list|(
name|left
argument_list|,
name|right
argument_list|,
name|ImmutableList
operator|.
name|of
argument_list|()
argument_list|,
name|condition
argument_list|,
name|variablesSet
argument_list|,
name|joinType
argument_list|,
name|semiJoinDone
argument_list|)
return|;
block|}
annotation|@
name|Deprecated
comment|// to be removed before 1.23
specifier|default
name|RelNode
name|createJoin
parameter_list|(
name|RelNode
name|left
parameter_list|,
name|RelNode
name|right
parameter_list|,
name|RexNode
name|condition
parameter_list|,
name|JoinRelType
name|joinType
parameter_list|,
name|Set
argument_list|<
name|String
argument_list|>
name|variablesStopped
parameter_list|,
name|boolean
name|semiJoinDone
parameter_list|)
block|{
return|return
name|createJoin
argument_list|(
name|left
argument_list|,
name|right
argument_list|,
name|ImmutableList
operator|.
name|of
argument_list|()
argument_list|,
name|condition
argument_list|,
name|CorrelationId
operator|.
name|setOf
argument_list|(
name|variablesStopped
argument_list|)
argument_list|,
name|joinType
argument_list|,
name|semiJoinDone
argument_list|)
return|;
block|}
block|}
comment|/**    * Implementation of {@link JoinFactory} that returns a vanilla    * {@link org.apache.calcite.rel.logical.LogicalJoin}.    */
specifier|private
specifier|static
class|class
name|JoinFactoryImpl
implements|implements
name|JoinFactory
block|{
specifier|public
name|RelNode
name|createJoin
parameter_list|(
name|RelNode
name|left
parameter_list|,
name|RelNode
name|right
parameter_list|,
name|List
argument_list|<
name|RelHint
argument_list|>
name|hints
parameter_list|,
name|RexNode
name|condition
parameter_list|,
name|Set
argument_list|<
name|CorrelationId
argument_list|>
name|variablesSet
parameter_list|,
name|JoinRelType
name|joinType
parameter_list|,
name|boolean
name|semiJoinDone
parameter_list|)
block|{
return|return
name|LogicalJoin
operator|.
name|create
argument_list|(
name|left
argument_list|,
name|right
argument_list|,
name|hints
argument_list|,
name|condition
argument_list|,
name|variablesSet
argument_list|,
name|joinType
argument_list|,
name|semiJoinDone
argument_list|,
name|ImmutableList
operator|.
name|of
argument_list|()
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a correlate of the appropriate type for a rule's calling    * convention.    *    *<p>The result is typically a {@link Correlate}.    */
specifier|public
interface|interface
name|CorrelateFactory
block|{
comment|/**      * Creates a correlate.      *      * @param left             Left input      * @param right            Right input      * @param correlationId    Variable name for the row of left input      * @param requiredColumns  Required columns      * @param joinType         Join type      */
name|RelNode
name|createCorrelate
parameter_list|(
name|RelNode
name|left
parameter_list|,
name|RelNode
name|right
parameter_list|,
name|CorrelationId
name|correlationId
parameter_list|,
name|ImmutableBitSet
name|requiredColumns
parameter_list|,
name|JoinRelType
name|joinType
parameter_list|)
function_decl|;
block|}
comment|/**    * Implementation of {@link CorrelateFactory} that returns a vanilla    * {@link org.apache.calcite.rel.logical.LogicalCorrelate}.    */
specifier|private
specifier|static
class|class
name|CorrelateFactoryImpl
implements|implements
name|CorrelateFactory
block|{
specifier|public
name|RelNode
name|createCorrelate
parameter_list|(
name|RelNode
name|left
parameter_list|,
name|RelNode
name|right
parameter_list|,
name|CorrelationId
name|correlationId
parameter_list|,
name|ImmutableBitSet
name|requiredColumns
parameter_list|,
name|JoinRelType
name|joinType
parameter_list|)
block|{
return|return
name|LogicalCorrelate
operator|.
name|create
argument_list|(
name|left
argument_list|,
name|right
argument_list|,
name|correlationId
argument_list|,
name|requiredColumns
argument_list|,
name|joinType
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a semi-join of the appropriate type for a rule's calling    * convention.    *    * @deprecated Use {@link JoinFactory} instead.    */
annotation|@
name|Deprecated
comment|// to be removed before 2.0
specifier|public
interface|interface
name|SemiJoinFactory
block|{
comment|/**      * Creates a semi-join.      *      * @param left             Left input      * @param right            Right input      * @param condition        Join condition      */
name|RelNode
name|createSemiJoin
parameter_list|(
name|RelNode
name|left
parameter_list|,
name|RelNode
name|right
parameter_list|,
name|RexNode
name|condition
parameter_list|)
function_decl|;
block|}
comment|/**    * Implementation of {@link SemiJoinFactory} that returns a vanilla    * {@link Join} with join type as {@link JoinRelType#SEMI}.    *    * @deprecated Use {@link JoinFactoryImpl} instead.    */
annotation|@
name|Deprecated
comment|// to be removed before 2.0
specifier|private
specifier|static
class|class
name|SemiJoinFactoryImpl
implements|implements
name|SemiJoinFactory
block|{
specifier|public
name|RelNode
name|createSemiJoin
parameter_list|(
name|RelNode
name|left
parameter_list|,
name|RelNode
name|right
parameter_list|,
name|RexNode
name|condition
parameter_list|)
block|{
return|return
name|LogicalJoin
operator|.
name|create
argument_list|(
name|left
argument_list|,
name|right
argument_list|,
name|condition
argument_list|,
name|ImmutableSet
operator|.
name|of
argument_list|()
argument_list|,
name|JoinRelType
operator|.
name|SEMI
argument_list|,
literal|false
argument_list|,
name|ImmutableList
operator|.
name|of
argument_list|()
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a {@link Values} of the appropriate type for a rule's calling    * convention.    */
specifier|public
interface|interface
name|ValuesFactory
block|{
comment|/**      * Creates a Values.      */
name|RelNode
name|createValues
parameter_list|(
name|RelOptCluster
name|cluster
parameter_list|,
name|RelDataType
name|rowType
parameter_list|,
name|List
argument_list|<
name|ImmutableList
argument_list|<
name|RexLiteral
argument_list|>
argument_list|>
name|tuples
parameter_list|)
function_decl|;
block|}
comment|/**    * Implementation of {@link ValuesFactory} that returns a    * {@link LogicalValues}.    */
specifier|private
specifier|static
class|class
name|ValuesFactoryImpl
implements|implements
name|ValuesFactory
block|{
specifier|public
name|RelNode
name|createValues
parameter_list|(
name|RelOptCluster
name|cluster
parameter_list|,
name|RelDataType
name|rowType
parameter_list|,
name|List
argument_list|<
name|ImmutableList
argument_list|<
name|RexLiteral
argument_list|>
argument_list|>
name|tuples
parameter_list|)
block|{
return|return
name|LogicalValues
operator|.
name|create
argument_list|(
name|cluster
argument_list|,
name|rowType
argument_list|,
name|ImmutableList
operator|.
name|copyOf
argument_list|(
name|tuples
argument_list|)
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a {@link TableScan} of the appropriate type for a rule's calling    * convention.    */
specifier|public
interface|interface
name|TableScanFactory
block|{
comment|/**      * Creates a {@link TableScan}.      */
name|RelNode
name|createScan
parameter_list|(
name|RelOptCluster
name|cluster
parameter_list|,
name|RelOptTable
name|table
parameter_list|,
name|List
argument_list|<
name|RelHint
argument_list|>
name|hints
parameter_list|)
function_decl|;
annotation|@
name|Deprecated
comment|// to be removed before 1.23
specifier|default
name|RelNode
name|createScan
parameter_list|(
name|RelOptCluster
name|cluster
parameter_list|,
name|RelOptTable
name|table
parameter_list|)
block|{
return|return
name|createScan
argument_list|(
name|cluster
argument_list|,
name|table
argument_list|,
name|ImmutableList
operator|.
name|of
argument_list|()
argument_list|)
return|;
block|}
block|}
comment|/**    * Implementation of {@link TableScanFactory} that returns a    * {@link LogicalTableScan}.    */
specifier|private
specifier|static
class|class
name|TableScanFactoryImpl
implements|implements
name|TableScanFactory
block|{
specifier|public
name|RelNode
name|createScan
parameter_list|(
name|RelOptCluster
name|cluster
parameter_list|,
name|RelOptTable
name|table
parameter_list|,
name|List
argument_list|<
name|RelHint
argument_list|>
name|hints
parameter_list|)
block|{
return|return
name|LogicalTableScan
operator|.
name|create
argument_list|(
name|cluster
argument_list|,
name|table
argument_list|,
name|hints
argument_list|)
return|;
block|}
block|}
comment|/**    * Creates a {@link TableScanFactory} that can expand    * {@link TranslatableTable} instances, but explodes on views.    *    * @param tableScanFactory Factory for non-translatable tables    * @return Table scan factory    */
annotation|@
name|Nonnull
specifier|public
specifier|static
name|TableScanFactory
name|expandingScanFactory
parameter_list|(
annotation|@
name|Nonnull
name|TableScanFactory
name|tableScanFactory
parameter_list|)
block|{
return|return
name|expandingScanFactory
argument_list|(
parameter_list|(
name|rowType
parameter_list|,
name|queryString
parameter_list|,
name|schemaPath
parameter_list|,
name|viewPath
parameter_list|)
lambda|->
block|{
throw|throw
operator|new
name|UnsupportedOperationException
argument_list|(
literal|"cannot expand view"
argument_list|)
throw|;
block|}
argument_list|,
name|tableScanFactory
argument_list|)
return|;
block|}
comment|/**    * Creates a {@link TableScanFactory} that uses a    * {@link org.apache.calcite.plan.RelOptTable.ViewExpander} to handle    * {@link TranslatableTable} instances, and falls back to a default    * factory for other tables.    *    * @param viewExpander View expander    * @param tableScanFactory Factory for non-translatable tables    * @return Table scan factory    */
annotation|@
name|Nonnull
specifier|public
specifier|static
name|TableScanFactory
name|expandingScanFactory
parameter_list|(
annotation|@
name|Nonnull
name|RelOptTable
operator|.
name|ViewExpander
name|viewExpander
parameter_list|,
annotation|@
name|Nonnull
name|TableScanFactory
name|tableScanFactory
parameter_list|)
block|{
return|return
parameter_list|(
name|cluster
parameter_list|,
name|table
parameter_list|,
name|hints
parameter_list|)
lambda|->
block|{
specifier|final
name|TranslatableTable
name|translatableTable
init|=
name|table
operator|.
name|unwrap
argument_list|(
name|TranslatableTable
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|translatableTable
operator|!=
literal|null
condition|)
block|{
specifier|final
name|RelOptTable
operator|.
name|ToRelContext
name|toRelContext
init|=
name|ViewExpanders
operator|.
name|toRelContext
argument_list|(
name|viewExpander
argument_list|,
name|cluster
argument_list|,
name|hints
argument_list|)
decl_stmt|;
return|return
name|translatableTable
operator|.
name|toRel
argument_list|(
name|toRelContext
argument_list|,
name|table
argument_list|)
return|;
block|}
return|return
name|tableScanFactory
operator|.
name|createScan
argument_list|(
name|cluster
argument_list|,
name|table
argument_list|,
name|hints
argument_list|)
return|;
block|}
return|;
block|}
comment|/**    * Can create a {@link TableFunctionScan}    * of the appropriate type for a rule's calling convention.    */
specifier|public
interface|interface
name|TableFunctionScanFactory
block|{
comment|/** Creates a {@link TableFunctionScan}. */
name|RelNode
name|createTableFunctionScan
parameter_list|(
name|RelOptCluster
name|cluster
parameter_list|,
name|List
argument_list|<
name|RelNode
argument_list|>
name|inputs
parameter_list|,
name|RexNode
name|rexCall
parameter_list|,
name|Type
name|elementType
parameter_list|,
name|Set
argument_list|<
name|RelColumnMapping
argument_list|>
name|columnMappings
parameter_list|)
function_decl|;
block|}
comment|/**    * Implementation of    * {@link TableFunctionScanFactory}    * that returns a {@link TableFunctionScan}.    */
specifier|private
specifier|static
class|class
name|TableFunctionScanFactoryImpl
implements|implements
name|TableFunctionScanFactory
block|{
annotation|@
name|Override
specifier|public
name|RelNode
name|createTableFunctionScan
parameter_list|(
name|RelOptCluster
name|cluster
parameter_list|,
name|List
argument_list|<
name|RelNode
argument_list|>
name|inputs
parameter_list|,
name|RexNode
name|rexCall
parameter_list|,
name|Type
name|elementType
parameter_list|,
name|Set
argument_list|<
name|RelColumnMapping
argument_list|>
name|columnMappings
parameter_list|)
block|{
return|return
name|LogicalTableFunctionScan
operator|.
name|create
argument_list|(
name|cluster
argument_list|,
name|inputs
argument_list|,
name|rexCall
argument_list|,
name|elementType
argument_list|,
name|rexCall
operator|.
name|getType
argument_list|()
argument_list|,
name|columnMappings
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a {@link Snapshot} of    * the appropriate type for a rule's calling convention.    */
specifier|public
interface|interface
name|SnapshotFactory
block|{
comment|/**      * Creates a {@link Snapshot}.      */
name|RelNode
name|createSnapshot
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RexNode
name|period
parameter_list|)
function_decl|;
block|}
comment|/**    * Implementation of {@link RelFactories.SnapshotFactory} that    * returns a vanilla {@link LogicalSnapshot}.    */
specifier|public
specifier|static
class|class
name|SnapshotFactoryImpl
implements|implements
name|SnapshotFactory
block|{
specifier|public
name|RelNode
name|createSnapshot
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RexNode
name|period
parameter_list|)
block|{
return|return
name|LogicalSnapshot
operator|.
name|create
argument_list|(
name|input
argument_list|,
name|period
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a {@link Match} of    * the appropriate type for a rule's calling convention.    */
specifier|public
interface|interface
name|MatchFactory
block|{
comment|/** Creates a {@link Match}. */
name|RelNode
name|createMatch
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RexNode
name|pattern
parameter_list|,
name|RelDataType
name|rowType
parameter_list|,
name|boolean
name|strictStart
parameter_list|,
name|boolean
name|strictEnd
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|RexNode
argument_list|>
name|patternDefinitions
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|RexNode
argument_list|>
name|measures
parameter_list|,
name|RexNode
name|after
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|?
extends|extends
name|SortedSet
argument_list|<
name|String
argument_list|>
argument_list|>
name|subsets
parameter_list|,
name|boolean
name|allRows
parameter_list|,
name|ImmutableBitSet
name|partitionKeys
parameter_list|,
name|RelCollation
name|orderKeys
parameter_list|,
name|RexNode
name|interval
parameter_list|)
function_decl|;
block|}
comment|/**    * Implementation of {@link MatchFactory}    * that returns a {@link LogicalMatch}.    */
specifier|private
specifier|static
class|class
name|MatchFactoryImpl
implements|implements
name|MatchFactory
block|{
specifier|public
name|RelNode
name|createMatch
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|RexNode
name|pattern
parameter_list|,
name|RelDataType
name|rowType
parameter_list|,
name|boolean
name|strictStart
parameter_list|,
name|boolean
name|strictEnd
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|RexNode
argument_list|>
name|patternDefinitions
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|RexNode
argument_list|>
name|measures
parameter_list|,
name|RexNode
name|after
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|?
extends|extends
name|SortedSet
argument_list|<
name|String
argument_list|>
argument_list|>
name|subsets
parameter_list|,
name|boolean
name|allRows
parameter_list|,
name|ImmutableBitSet
name|partitionKeys
parameter_list|,
name|RelCollation
name|orderKeys
parameter_list|,
name|RexNode
name|interval
parameter_list|)
block|{
return|return
name|LogicalMatch
operator|.
name|create
argument_list|(
name|input
argument_list|,
name|rowType
argument_list|,
name|pattern
argument_list|,
name|strictStart
argument_list|,
name|strictEnd
argument_list|,
name|patternDefinitions
argument_list|,
name|measures
argument_list|,
name|after
argument_list|,
name|subsets
argument_list|,
name|allRows
argument_list|,
name|partitionKeys
argument_list|,
name|orderKeys
argument_list|,
name|interval
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a {@link Spool} of    * the appropriate type for a rule's calling convention.    */
annotation|@
name|Experimental
specifier|public
interface|interface
name|SpoolFactory
block|{
comment|/** Creates a {@link TableSpool}. */
name|RelNode
name|createTableSpool
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|Spool
operator|.
name|Type
name|readType
parameter_list|,
name|Spool
operator|.
name|Type
name|writeType
parameter_list|,
name|RelOptTable
name|table
parameter_list|)
function_decl|;
block|}
comment|/**    * Implementation of {@link SpoolFactory}    * that returns Logical Spools.    */
specifier|private
specifier|static
class|class
name|SpoolFactoryImpl
implements|implements
name|SpoolFactory
block|{
specifier|public
name|RelNode
name|createTableSpool
parameter_list|(
name|RelNode
name|input
parameter_list|,
name|Spool
operator|.
name|Type
name|readType
parameter_list|,
name|Spool
operator|.
name|Type
name|writeType
parameter_list|,
name|RelOptTable
name|table
parameter_list|)
block|{
return|return
name|LogicalTableSpool
operator|.
name|create
argument_list|(
name|input
argument_list|,
name|readType
argument_list|,
name|writeType
argument_list|,
name|table
argument_list|)
return|;
block|}
block|}
comment|/**    * Can create a {@link RepeatUnion} of    * the appropriate type for a rule's calling convention.    */
annotation|@
name|Experimental
specifier|public
interface|interface
name|RepeatUnionFactory
block|{
comment|/** Creates a {@link RepeatUnion}. */
name|RelNode
name|createRepeatUnion
parameter_list|(
name|RelNode
name|seed
parameter_list|,
name|RelNode
name|iterative
parameter_list|,
name|boolean
name|all
parameter_list|,
name|int
name|iterationLimit
parameter_list|)
function_decl|;
block|}
comment|/**    * Implementation of {@link RepeatUnion}    * that returns a {@link LogicalRepeatUnion}.    */
specifier|private
specifier|static
class|class
name|RepeatUnionFactoryImpl
implements|implements
name|RepeatUnionFactory
block|{
specifier|public
name|RelNode
name|createRepeatUnion
parameter_list|(
name|RelNode
name|seed
parameter_list|,
name|RelNode
name|iterative
parameter_list|,
name|boolean
name|all
parameter_list|,
name|int
name|iterationLimit
parameter_list|)
block|{
return|return
name|LogicalRepeatUnion
operator|.
name|create
argument_list|(
name|seed
argument_list|,
name|iterative
argument_list|,
name|all
argument_list|,
name|iterationLimit
argument_list|)
return|;
block|}
block|}
block|}
end_class

end_unit

